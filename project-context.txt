// ====== FILE: components.json ======

{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "src/app/globals.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "iconLibrary": "lucide"
}

// ====== FILE: next.config.ts ======

import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  images: {
    remotePatterns: [
      {
        protocol: "https",
        hostname: "public.linear.app",
        pathname: "/**",
      },
      {
        protocol: "http",
        hostname: "localhost",
        pathname: "/**",
      },
    ],
  },

  async headers() {
    return [
      {
        source: "/favicon.ico",
        headers: [
          {
            key: "Cache-Control",
            value: "public, max-age=86400",
          },
        ],
      },
    ];
  },
};

export default nextConfig;

// ====== FILE: package.json ======

{
  "name": "enablement-front",
  "version": "1.0.0",
  "type": "module",
  "private": true,
  "scripts": {
    "dev": "next dev --turbopack",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
  "dependencies": {
    "@apollo/client": "^3.12.9",
    "@radix-ui/react-slot": "^1.1.2",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "framer-motion": "^12.3.1",
    "graphql": "^16.10.0",
    "lucide-react": "^0.475.0",
    "next": "15.1.6",
    "react": "^19.0.0",
    "react-datepicker": "^8.0.0",
    "react-dom": "^19.0.0",
    "socket.io-client": "^4.8.1",
    "tailwind-merge": "^3.0.1",
    "tailwindcss-animate": "^1.0.7",
    "zustand": "^5.0.3"
  },
  "devDependencies": {
    "@eslint/eslintrc": "^3",
    "@tailwindcss/postcss": "^4.0.0",
    "@types/node": "^20",
    "@types/react": "^19.0.8",
    "@types/react-dom": "^19.0.3",
    "eslint": "^9",
    "eslint-config-next": "15.1.6",
    "postcss": "^8.5.2",
    "tailwindcss": "^4.0.0",
    "typescript": "^5"
  }
}

// ====== FILE: tsconfig.json ======

{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}

// ====== FILE: src\app\ApolloWrapper.tsx ======

// src/app/ApolloWrapper.tsx
"use client";

import React, { ReactNode } from "react";
import { ApolloProvider } from "@apollo/client/react";
import client from "@/app/lib/apolloClient";

interface ApolloWrapperProps {
  children: ReactNode;
}

export default function ApolloWrapper({ children }: ApolloWrapperProps) {
  return <ApolloProvider client={client}>{children}</ApolloProvider>;
}

// ====== FILE: src\app\globals.css ======

@import "tailwindcss";
/*
  ---break---
*/
@plugin 'tailwindcss-animate';
/*
  ---break---
*/
@custom-variant dark (&:is(.dark *));

@theme {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
}

/*
  The default border color has changed to `currentColor` in Tailwind CSS v4,
  so we've added these compatibility styles to make sure everything still
  looks the same as it did with Tailwind CSS v3.

  If we ever want to remove these styles, we need to add an explicit border
  color utility to any element that depends on these defaults.
*/
@layer base {
  *,
  ::after,
  ::before,
  ::backdrop,
  ::file-selector-button {
    border-color: var(--color-gray-200, currentColor);
  }
}

/*
  ---break---
*/
:root {
  --background: hsl(0 0% 100%);
  --foreground: hsl(0 0% 3.9%);
  --card: hsl(0 0% 100%);
  --card-foreground: hsl(0 0% 3.9%);
  --popover: hsl(0 0% 100%);
  --popover-foreground: hsl(0 0% 3.9%);
  --primary: hsl(0 0% 9%);
  --primary-foreground: hsl(0 0% 98%);
  --secondary: hsl(0 0% 96.1%);
  --secondary-foreground: hsl(0 0% 9%);
  --muted: hsl(0 0% 96.1%);
  --muted-foreground: hsl(0 0% 45.1%);
  --accent: hsl(0 0% 96.1%);
  --accent-foreground: hsl(0 0% 9%);
  --destructive: hsl(0 84.2% 60.2%);
  --destructive-foreground: hsl(0 0% 98%);
  --border: hsl(0 0% 89.8%);
  --input: hsl(0 0% 89.8%);
  --ring: hsl(0 0% 3.9%);
  --chart-1: hsl(12 76% 61%);
  --chart-2: hsl(173 58% 39%);
  --chart-3: hsl(197 37% 24%);
  --chart-4: hsl(43 74% 66%);
  --chart-5: hsl(27 87% 67%);
  --radius: 0.6rem;
}
/*
  ---break---
*/
.dark {
  --background: hsl(0 0% 3.9%);
  --foreground: hsl(0 0% 98%);
  --card: hsl(0 0% 3.9%);
  --card-foreground: hsl(0 0% 98%);
  --popover: hsl(0 0% 3.9%);
  --popover-foreground: hsl(0 0% 98%);
  --primary: hsl(0 0% 98%);
  --primary-foreground: hsl(0 0% 9%);
  --secondary: hsl(0 0% 14.9%);
  --secondary-foreground: hsl(0 0% 98%);
  --muted: hsl(0 0% 14.9%);
  --muted-foreground: hsl(0 0% 63.9%);
  --accent: hsl(0 0% 14.9%);
  --accent-foreground: hsl(0 0% 98%);
  --destructive: hsl(0 62.8% 30.6%);
  --destructive-foreground: hsl(0 0% 98%);
  --border: hsl(0 0% 14.9%);
  --input: hsl(0 0% 14.9%);
  --ring: hsl(0 0% 83.1%);
  --chart-1: hsl(220 70% 50%);
  --chart-2: hsl(160 60% 45%);
  --chart-3: hsl(30 80% 55%);
  --chart-4: hsl(280 65% 60%);
  --chart-5: hsl(340 75% 55%);
}
/*
  ---break---
*/
@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-destructive-foreground: var(--destructive-foreground);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
  --color-chart-1: var(--chart-1);
  --color-chart-2: var(--chart-2);
  --color-chart-3: var(--chart-3);
  --color-chart-4: var(--chart-4);
  --color-chart-5: var(--chart-5);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
}
/*
  ---break---
*/
@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
  }
}

/* @layer components {
  .bg-black select,
  .bg-black input,
  .bg-black textarea {
    color: white;
  }
} */
@layer components {
  /* Or append to @layer base */
  /* Fix for dropdown and input colors in black backgrounds - INVERT COLORS */
  .bg-black select,
  .bg-black input,
  .bg-black textarea {
    color: black; /* Set text color to black */
    background-color: white; /* Set background color to white */
    border-color: var(--color-border); /* Optionally, match border color */
  }
}

// ====== FILE: src\app\layout.tsx ======

import ApolloWrapper from "../app/ApolloWrapper";
import type { Metadata } from "next";
import {
  Geist,
  Geist_Mono,
  Roboto_Condensed,
  PT_Sans,
  Rubik,
} from "next/font/google";
import "./globals.css";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

const robotoCondensed = Roboto_Condensed({
  subsets: ["latin"],
  weight: ["300", "400", "500", "600", "800"],
  variable: "--font-roboto-condensed",
});

const ptSans = PT_Sans({
  weight: ["400", "700"],
  subsets: ["latin"],
  variable: "--font-pt-sans",
});

const rubik = Rubik({
  subsets: ["latin"],
  weight: ["300", "400", "500", "600", "700", "800", "900"],
  variable: "--font-rubik",
});

export const metadata: Metadata = {
  title: "Enablment",
  description: "Project Management Platform",
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html
      lang="en"
      className={`
      ${geistSans.variable}
      ${geistMono.variable}
      ${robotoCondensed.variable}
      ${ptSans.variable}
      ${rubik.variable}
    `}
    >
      <body className="antialiased">
        <ApolloWrapper>{children}</ApolloWrapper>
      </body>
    </html>
  );
}

// ====== FILE: src\app\page.tsx ======

"use client";

import React from "react";
import { AnimatePresence, motion } from "framer-motion";
import type { NextPage } from "next";
import { useState } from "react";
import NavBar from "@/app/components/navBar";
import { BackgroundBeams } from "@/app/components/ui/background-beams";
import ContactForm from "@/app/components/contactForm";
import ClientColab from "@/app/components/clientColab";
import Footer from "@/app/components/footer";
import SectionAnimation from "@/app/components/sectionAnimation";

const Home: NextPage = () => {
  const sections = [
    "Home",
    "About",
    "Services",
    "People",
    "Contact",
    "Client-Portal",
  ];

  const [activeSection, setActiveSection] = useState<string>(sections[0]);
  const isContactActive = activeSection === "Contact";
  const [navigationDirection, setNavigationDirection] = useState<
    "forward" | "backward"
  >("forward");

  const closeContactForm = () => {
    setActiveSection("Home");
  };

  const handleFormSubmit = (data: {
    name: string;
    email: string;
    message: string;
  }) => {
    console.log("Form Data:", data);
    setActiveSection("Home");
  };

  const handleSectionChange = (section: string) => {
    // Determine direction based on section index
    const currentIndex = sections.indexOf(activeSection);
    const nextIndex = sections.indexOf(section);
    setNavigationDirection(nextIndex > currentIndex ? "forward" : "backward");
    setActiveSection(section);
  };

  return (
    <>
      <BackgroundBeams />
      <div className="relative overflow-hidden" style={{ minHeight: "100vh" }}>
        <NavBar
          sections={sections}
          setActiveSection={handleSectionChange}
          activeSection={activeSection}
        />

        {/* Contact form overlay */}
        <AnimatePresence>
          {isContactActive && (
            <ContactForm
              onSubmit={handleFormSubmit}
              onClose={closeContactForm}
            />
          )}
        </AnimatePresence>

        <div className="grid grid-cols-12 pt-6" style={{ minHeight: "60vh" }}>
          {/* Client collaboration component for Home section - Take 3 columns on the left */}
          <div className="col-span-3">
            <AnimatePresence>
              {activeSection === "Home" && (
                <motion.div
                  className="flex justify-center items-start client-table"
                  initial={{ opacity: 0 }}
                  animate={{ opacity: 1 }}
                  exit={{ opacity: 0 }}
                  transition={{ duration: 0.3 }}
                >
                  <ClientColab
                    onContactClick={() => setActiveSection("Contact")}
                  />
                </motion.div>
              )}
            </AnimatePresence>
          </div>

          {/* Main section content - Take 9 columns on the right */}
          <div className="col-span-9 relative">
            <AnimatePresence mode="wait">
              {sections.map((section) => {
                if (section === "Contact") {
                  return null;
                }
                let videoSrc;
                if (section === "Home") {
                  videoSrc = "/video/hero_vid.mp4";
                }

                // Only render active section
                return (
                  activeSection === section && (
                    <SectionAnimation
                      key={section}
                      section={section}
                      navigationDirection={navigationDirection}
                      videoSrc={videoSrc}
                    />
                  )
                );
              })}
            </AnimatePresence>
          </div>
        </div>
      </div>
      <Footer />
    </>
  );
};

export default Home;

// ====== FILE: src\app\types.ts ======

export interface TimeEntry {
  id: number;
  startTime: string;
  endTime: string;
  totalElapsedTime: number;
}

export interface CreateTimeEntryVariables {
  timeInputCreate: {
    startTime: string;
    endTime?: string;
    projectId: string;
    userId: number;
    rateId: number;
    totalElapsedTime: number;
  };
}

export interface UpdateTimeEntryVariables {
  timeInputUpdate: {
    id: number;
    endTime: string;
    totalElapsedTime: number;
  };
}

export interface Rate {
  id: string;
  name: string;
  rate: number;
}

export interface FeedbackState {
  submissionSuccess: boolean;
  submissionError: string;
  dateAlertMessage: string | null;
  resetMessage: boolean;
}

export interface TimerState {
  isRunning: boolean;
  startTime: Date | null;
  displayTime: string;
  start: () => void;
  pause: () => void;
  reset: () => void;
  setStartTime: (date: Date | null) => void;
}

// ====== FILE: src\app\adminPage\page.tsx ======

"use client";

import React, { useEffect, useState } from "react";
import { useQuery, useMutation, ApolloError } from "@apollo/client";
import NavigationBar from "../components/NavigationBar";
import UserTable from "@/app/components/Admin/UserTable";
import {
  GET_USERS,
  GET_SIMPLE_TEAMS,
  UPDATE_USER_ROLE,
  ADD_USER_TO_TEAM,
  REMOVE_USER_FROM_TEAM,
} from "@/app/graphql/adminOperations";
import TotalTimeSpent from "@/app/components/Admin/totalTimeSpent";
import RatesManager from "@/app/components/Admin/ratesManager";
import InvoiceSummary from "@/app/components/Admin/invoiceSummary";
import DBSyncPage from "@/app/dbSynch/page";

const AdminPage: React.FC = () => {
  const [users, setUsers] = useState([]);
  const [selectedTeam, setSelectedTeam] = useState<{
    [userId: number]: string;
  }>({});
  const [errorMessage, setErrorMessage] = useState("");

  const {
    loading: loadingUsers,
    error: errorUsers,
    data: dataUsers,
    refetch: refetchUsers,
  } = useQuery(GET_USERS);

  const { loading: loadingTeams, data: dataTeams } = useQuery(GET_SIMPLE_TEAMS);

  const [updateUserRole] = useMutation(UPDATE_USER_ROLE);
  const [addUserToTeam] = useMutation(ADD_USER_TO_TEAM, {
    onCompleted: () => refetchUsers(),
  });
  const [removeUserFromTeam] = useMutation(REMOVE_USER_FROM_TEAM, {
    onCompleted: () => refetchUsers(),
    onError: (error) => {
      console.error("Error removing user from team:", error);
    },
  });

  useEffect(() => {
    if (dataUsers) {
      setUsers(dataUsers.users);
    }
  }, [dataUsers]);

  if (loadingUsers || loadingTeams) return <p>Loading...</p>;
  if (errorUsers) {
    const graphQLError = errorUsers.graphQLErrors[0];
    if (graphQLError && graphQLError.extensions?.code === "FORBIDDEN") {
      return <p>You do not have permission to view this resource.</p>;
    }
    return <p>Error: {errorUsers.message}</p>;
  }

  const handleTeamSelect = (userId: number, teamId: string) => {
    setSelectedTeam((prev) => ({ ...prev, [userId]: teamId }));
  };

  const handleAddToTeam = (userId: number) => {
    const teamId = selectedTeam[userId];
    if (!teamId) {
      console.error("No team selected for user:", userId);
      return;
    }
    addUserToTeam({ variables: { userId, teamId } }).catch((error) =>
      console.error("Error adding user to team:", error)
    );
  };

  const handleRemoveFromTeam = (userId: number, teamId: string) => {
    removeUserFromTeam({ variables: { userId, teamId } }).catch((error) =>
      console.error("Error removing user from team:", error)
    );
  };

  const handleRoleChange = async (userId: number, newRole: string) => {
    try {
      await updateUserRole({ variables: { userId, newRole } });
      setErrorMessage("");
    } catch (error) {
      if (error instanceof ApolloError) {
        setErrorMessage(
          error.graphQLErrors[0]?.message || "Error updating role"
        );
      } else {
        console.error("Error updating user role:", error);
        setErrorMessage("An unexpected error occurred");
      }
    }
  };

  return (
    <>
      <NavigationBar />
      <div className="container mx-auto p-4 font-roboto-condensed">
        <div className="container mx-auto p-4 font-roboto-condensed">
          <div className="mb-3">
            <UserTable
              users={users}
              teams={dataTeams?.getAllSimpleTeams}
              onTeamSelect={handleTeamSelect}
              onAddToTeam={handleAddToTeam}
              onRemoveFromTeam={handleRemoveFromTeam}
              onRoleChange={handleRoleChange}
            />
            {errorMessage && <p className="text-red-500">{errorMessage}</p>}
          </div>
          <div className="mb-3 shadow-md">
            <TotalTimeSpent />
          </div>
          <div className="mb-3 shadow-md">
            <RatesManager />
          </div>
          <div className="shadow-md">
            <InvoiceSummary />
          </div>
          <DBSyncPage />
        </div>
      </div>
    </>
  );
};

export default AdminPage;

// ====== FILE: src\app\components\aboutSection.tsx ======

import React from "react";

interface IDefinition {
  term: string;
  description: string;
}

interface IAboutContent {
  definitions: IDefinition[];
  transparency: string[];
  organization: string[];
}

const aboutContent: IAboutContent = {
  definitions: [
    {
      term: "Collaborator",
      description:
        "Is a client company, who is subject to a collaboration with Enablment.",
    },
    {
      term: "Enabler",
      description:
        "Conventionally known as a consultant, but we enable Collaborators. We exist because we are Enablers who love to devise and create delightful technical solutions with Collaborators.",
    },
  ],
  transparency: [
    "We demystify the conventional consultancy-client relationship.",
    "We want transparency. In the sense that we have structurally implemented it in our professional relationship with Collaborators.",
    "We want to communicate openly with Collaborators whether an Enabler is experienced in the given tech or needs to learn new components.",
    "Consequently, we deploy varied rates for varied tasks, supported by a decision tree and a detailed invoice report.",
  ],
  organization: [
    "We place decision-making where it is due.",
    "Enablment is expanding on the idea of a flat hierarchy and is transitioning towards an organization with distributed leadership.",
    "We have a passion for rethinking and refining processes, why we deploy slim and execution-oriented project teams. That means we have redefined the project manager as a role that is shared by Collaborators and Enablers, but it is structured by a system landscape.",
    "We have added what we call work groups. These are diverse groups of Enablers which only exist to support each other in their decision-making.",
    "At Enablement, everyone is passionate about digitization and capable to execute on it.",
  ],
};

const AboutSection: React.FC = () => {
  return (
    <div className="space-y-8 p-6">
      <h2 className="text-3xl mb-4 font-pt-sans-bold-900">About Enablment</h2>
      <div style={{ maxHeight: "calc(100vh - 300px)", overflowY: "auto" }}>
        <section className="pb-4">
          <h3 className="text-2xl font-semibold mb-2">Definitions</h3>
          {aboutContent.definitions.map((def, index) => (
            <div key={index} className="mb-3">
              <p style={{ lineHeight: "1.4" }} className="text-lg">
                <span className="font-bold">{def.term}:</span> {def.description}
              </p>
            </div>
          ))}
        </section>

        <section className="flex flex-col md:flex-row space-y-4 gap-4">
          <div className="md:w-1/2">
            <h3 className="text-2xl font-semibold mb-2">Transparency</h3>
            {aboutContent.transparency.map((item, index) => (
              <div key={index} className="mb-3">
                <p
                  style={{ lineHeight: "1.4" }}
                  className="text-lg font-roboto"
                >
                  {item}
                </p>
              </div>
            ))}
          </div>
          <div className="md:w-1/2 flex justify-center shadow-md">
            <video
              className="rounded-lg lazy h-full w-full object-cover"
              autoPlay
              loop
              muted
              playsInline
              preload="metadata"
            >
              <source src="/video/transparancy.mp4" type="video/mp4" />
              Your browser does not support the video tag.
            </video>
          </div>
        </section>

        <section className="flex flex-col md:flex-row-reverse mt-6 gap-4">
          <div className="md:w-1/2 mt-6">
            <h3 className="text-2xl font-semibold mb-2">Organization</h3>
            {aboutContent.organization.map((item, index) => (
              <div key={index} className="mb-3">
                <p
                  style={{ lineHeight: "1.4" }}
                  className="text-lg font-roboto"
                >
                  {item}
                </p>
              </div>
            ))}
          </div>
          <div className="md:w-1/2 flex justify-center">
            <video
              className="rounded-lg lazy h-full w-full object-cover"
              autoPlay
              loop
              muted
              playsInline
              preload="metadata"
            >
              <source src="/video/meeting.mp4" type="video/mp4" />
              Your browser does not support the video tag.
            </video>
          </div>
        </section>
      </div>
    </div>
  );
};

export default AboutSection;

// ====== FILE: src\app\components\clientColab.tsx ======

"use client";

import React from "react";

// Define the TypeScript type for the table data
type ClientServiceData = {
  client: string;
  year: number;
  services: string;
};
interface ServiceTableProps {
  onContactClick: () => void;
}

// Sample data array
const tableData: ClientServiceData[] = [
  {
    client: "Modstrøm",
    year: 2023,
    services: "Climate Footprint Reporting: Scope 1 and 2",
  },
  { client: "Junkfood", year: 2023, services: "Climate Footprint Reporting" },
  { client: "Confidential", year: 2023, services: "Cloud, User Platform" },
  { client: "Shipping Company", year: 2023, services: "Cloud, User Platform" },
  { client: "B93", year: 2023, services: "Website, UI & UX" },
  {
    client: "B:A:M",
    year: 2024,
    services: "Video Streaming Platform and Mobil App",
  },
  { client: "H5", year: 2024, services: "Website" },
];

const ClientColab: React.FC<ServiceTableProps> = ({ onContactClick }) => {
  return (
    <div className="flex flex-col mx-2 z-10">
      <p className="text-3xl font-semibold mb-2 text-center bg-white shadow rounded-lg sm:text-2xl">
        Our Happy Collaborators
      </p>
      {tableData.map((item, index) => (
        <div key={index} className="w-full pb-2">
          <div className="bg-white shadow rounded-lg sm:p-1 sm:text-sm">
            <h3 className="text-lg sm:text-md font-semibold">{item.client}</h3>
            <p className="text-gray-900 font-roboto">Year: {item.year}</p>
            <p className="text-gray-900 font-roboto">
              Services: {item.services}
            </p>
          </div>
        </div>
      ))}
      <div className="flex mt-2">
        <button
          className="bg-green-700 hover:bg-green-500 text-white font-bold py-2 px-4 rounded-full transition-colors duration-300 "
          onClick={onContactClick}
        >
          Shall we collaborate ?
        </button>
      </div>
    </div>
  );
};

export default ClientColab;

// ====== FILE: src\app\components\contactForm.tsx ======

"use client";

import React, { useState } from "react";
import Image from "next/image";
import { motion } from "framer-motion";

interface ContactFormProps {
  onSubmit: (data: { name: string; email: string; message: string }) => void;
  onClose: () => void;
  className?: string;
  isOverlay?: boolean;
}

const ContactForm: React.FC<ContactFormProps> = ({
  onSubmit,
  onClose,
  className = "",
  isOverlay = true,
}) => {
  const [formData, setFormData] = useState({
    name: "",
    email: "",
    message: "",
  });

  const handleChange = (
    e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>
  ) => {
    setFormData({ ...formData, [e.target.name]: e.target.value });
  };

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    onSubmit(formData);
  };

  const formContent = (
    <div className="bg-white flex gap-4 rounded-lg shadow-lg p-8 m-4 lg:w-10/12 max-h-full overflow-y-auto contact-form-container">
      <div>
        <video
          width="100%"
          height="auto"
          className="rounded-lg lazy"
          autoPlay
          loop
          muted
          playsInline
          preload="metadata"
        >
          <source src="/video/email.mp4" type="video/mp4" />
          Your browser does not support the video tag.
        </video>
        <div className="flex justify-between ">
          <div className="text-sm mt-4 w-1/2">
            <p>Øster Allé 56 6. sal</p>
            <p>2100 København Ø</p>
            <p>CVR: 42309648</p>
            <div className="lg:mt-6 flex flex-col space-y-2 lg:flex-row sm:mt-2 sm:space-y-0 lg:space-x-2 CandP">
              <a href="#" className="text-blue-700 hover:underline">
                Cookie policy
              </a>
              <span className="hidden lg:inline">•</span>
              <a href="#" className="text-blue-700 hover:underline">
                Privacy policy
              </a>
            </div>
          </div>
          <div className="flex flex-col items-end gap-2">
            <div className="flex mt-4">
              <span className="mr-3">
                <Image
                  src="/icons/instagram.svg"
                  alt="instagram"
                  width={24}
                  height={24}
                />
              </span>
              <span className="mr-3">
                <Image
                  src="/icons/facebook.svg"
                  alt="facebook"
                  width={24}
                  height={24}
                />
              </span>
              <span className="mr-4">
                <Image
                  src="/icons/linkedin.svg"
                  alt="linkedin"
                  width={24}
                  height={24}
                />
              </span>
              <span>
                <Image
                  src="/icons/twitter.svg"
                  alt="twitter"
                  width={24}
                  height={24}
                />
              </span>
            </div>
            <div className="flex gap-1 items-center mt-4">
              <span className="text-green-700">(+45) 22 92 67 80</span>
              <Image
                src="/icons/phone.svg"
                alt="call"
                width={24}
                height={24}
                className="align-middle"
              />
            </div>
            <div className="flex gap-1 items-center ">
              <span className="text-green-700 mb-1">gd@enablment.com</span>
              <Image
                src="/icons/mail.svg"
                alt="email"
                width={24}
                height={24}
                className="align-middle"
              />
            </div>
          </div>
        </div>
      </div>
      <div>
        <div className="flex flex-col justify-between h-full">
          <div className="flex justify-between items-center mb-4">
            <h2 className="text-lg text-gray-900">
              To: <span className="text-green-600 font-bold">Enablment</span>
            </h2>
            <button
              className="flex-none w-12 h-12 bg-black text-xl text-white rounded-full hover:bg-red-500 hover:scale-105 transition transform duration-200 ease-in-out"
              onClick={onClose}
            >
              ✕
            </button>
          </div>
          <form onSubmit={handleSubmit} className="flex flex-col flex-grow">
            <div className="flex-grow">
              <input
                type="text"
                name="name"
                placeholder="Name"
                className="w-full mb-4 p-2 border border-gray-500 rounded"
                onChange={handleChange}
                required
              />
              <input
                type="email"
                name="email"
                placeholder="E-mail"
                className="w-full mb-4 p-2 border border-gray-500 rounded"
                onChange={handleChange}
                required
              />
              <textarea
                name="message"
                placeholder="Your message"
                className="w-full mb-4 p-2 border border-gray-500 rounded"
                onChange={handleChange}
                required
              />
            </div>
            <div className="flex items-center mt-4 sm:mt-0">
              <div className="text-xs text-gray-500 flex-grow">
                This site is protected by reCAPTCHA and the Google
                <a href="#" className="text-blue-700 hover:underline">
                  {" "}
                  Privacy Policy
                </a>{" "}
                and
                <a href="#" className="text-blue-700 hover:underline">
                  {" "}
                  Terms of Service
                </a>{" "}
                apply.
              </div>
              <button
                type="submit"
                className="flex-none flex items-center justify-center w-12 h-12 bg-black text-white p-2 rounded-full hover:bg-green-500 hover:scale-105 transition transform duration-200 ease-in-out"
                aria-label="Send"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  className="w-6 h-6 text-white"
                >
                  <path
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    strokeWidth="2"
                    d="M14 5l7 7m0 0l-7 7m7-7H3"
                  />
                </svg>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  );

  // If not used as an overlay, just return the form content
  if (!isOverlay) {
    return formContent;
  }

  // Use as a modal overlay with animation
  return (
    <motion.div
      className={`fixed inset-0 flex justify-center items-center z-40 ${className}`}
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
      transition={{ duration: 0.3 }}
    >
      <div
        className="absolute inset-0 bg-black bg-opacity-50"
        onClick={onClose}
      ></div>
      <div className="z-50">{formContent}</div>
    </motion.div>
  );
};

export default ContactForm;

// ====== FILE: src\app\components\contentWrapper.tsx ======

"use client";

import { motion, useAnimation } from "framer-motion";
import React, { useEffect, PropsWithChildren } from "react";

interface ContentWrapperProps {
  isActive: boolean;
}

export const ContentWrapper: React.FC<
  PropsWithChildren<ContentWrapperProps>
> = ({ isActive, children }) => {
  const controls = useAnimation();

  useEffect(() => {
    controls.start(isActive ? "visible" : "hidden");
  }, [isActive, controls]);

  const contentVariants = {
    visible: {
      opacity: 1,
      maxHeight: "1000px",
      overflow: "hidden",
      transition: { duration: 0.5 },
    },
    hidden: {
      opacity: 0,
      maxHeight: 0, // Collapse content area when hidden
      overflow: "hidden",
      transition: { duration: 0.5 },
    },
  };

  return (
    <motion.div variants={contentVariants} animate={controls} initial="hidden">
      {children}
    </motion.div>
  );
};

// ====== FILE: src\app\components\FeedbackMessages.tsx ======

"use client";
import React from "react";

interface FeedbackMessagesProps {
  submissionSuccess: boolean;
  submissionError: string;
  resetMessage: boolean;
  dateAlertMessage: string | null;
}

const FeedbackMessages: React.FC<FeedbackMessagesProps> = ({
  submissionSuccess,
  submissionError,
  resetMessage,
  dateAlertMessage,
}) => {
  return (
    <div className="absolute top-5 right-5 z-50 flex flex-col items-end space-y-2">
      {submissionSuccess && (
        <div className="bg-green-100 text-green-800 text-sm font-semibold px-4 py-2 rounded-lg shadow-lg transition ease-out duration-300">
          Time entry saved!
        </div>
      )}
      {submissionError && (
        <div className="bg-red-100 text-red-800 text-sm font-semibold px-4 py-2 rounded-lg shadow-lg transition ease-out duration-300">
          {submissionError}
        </div>
      )}
      {resetMessage && (
        <div className="bg-yellow-500 text-blue-800 text-sm font-semibold px-4 py-2 rounded-lg shadow-lg transition ease-out duration-300">
          Timer reset!
        </div>
      )}
      {dateAlertMessage && (
        <div className="bg-red-100 text-red-800 text-sm font-semibold px-4 py-2 rounded-lg shadow-lg transition ease-out duration-300">
          {dateAlertMessage}
        </div>
      )}
    </div>
  );
};

export default FeedbackMessages;

// ====== FILE: src\app\components\footer.tsx ======

// FooterComponent.tsx
import React from "react";
import Image from "next/image";

const Footer: React.FC = () => {
  return (
    <div className="flex justify-between px-4 bg-gray-100 text-sm text-gray-600 mb-2">
      <div className="mt-4 w-1/2">
        <p>Øster Allé 56 6. sal</p>
        <p>2100 København Ø</p>
        <p>CVR: 42309648</p>
        <div className="flex flex-col space-y-2 sm:flex-row sm:space-y-0 sm:space-x-2 mt-4">
          <a href="#" className="text-blue-600 hover:underline">
            Cookie policy
          </a>
          <span className="hidden sm:inline">•</span>
          <a href="#" className="text-blue-600 hover:underline">
            Privacy policy
          </a>
        </div>
      </div>
      <div className="flex flex-col items-end gap-2 ">
        <div className="flex mt-2">
          <span className="mr-3">
            <Image
              src="/icons/instagram.svg"
              alt="instagram"
              width={24}
              height={24}
            />
          </span>
          <span className="mr-3">
            <Image
              src="/icons/facebook.svg"
              alt="facebook"
              width={24}
              height={24}
            />
          </span>
          <span className="mr-4">
            <Image
              src="/icons/linkedin.svg"
              alt="linkedin"
              width={24}
              height={24}
            />
          </span>
          <span>
            <Image
              src="/icons/twitter.svg"
              alt="twitter"
              width={24}
              height={24}
            />
          </span>
        </div>
        <div className="flex gap-1 items-center mt-4">
          <span className="text-black">(+45) 22 92 67 80</span>
          <Image src="/icons/phone.svg" alt="Call" width={24} height={24} />
        </div>
        <div className="flex gap-1 items-center">
          <span className="text-black mb-1">gd@enablment.com</span>
          <Image src="/icons/mail.svg" alt="Email" width={24} height={24} />
        </div>
      </div>
    </div>
  );
};

export default Footer;

// ====== FILE: src\app\components\navBar.tsx ======

"use client";

import React, { useState, useEffect } from "react";
import Image from "next/image";
import { useRouter } from "next/navigation";
import { motion } from "framer-motion";
import logo from "../../../public/logo.svg";

interface NavbarProps {
  sections: string[];
  setActiveSection: (section: string) => void;
  activeSection: string;
}

const NavBar: React.FC<NavbarProps> = ({
  sections = [],
  setActiveSection,
  activeSection,
}) => {
  const [hoveredSection, setHoveredSection] = useState<string | null>(null);
  const router = useRouter();
  const [isMenuOpen, setIsMenuOpen] = useState(false);

  // Automatically set the menu open on desktop and closed on mobile.
  useEffect(() => {
    const handleResize = () => {
      if (window.innerWidth >= 1024) {
        setIsMenuOpen(true);
      } else {
        setIsMenuOpen(false);
      }
    };

    // Run on mount
    handleResize();

    window.addEventListener("resize", handleResize);
    return () => window.removeEventListener("resize", handleResize);
  }, []);

  const handleSectionClick = (section: string) => {
    if (section === "Client-Portal") {
      router.push("/login");
    } else {
      setActiveSection(section);
    }
    // On mobile, close the menu after selection.
    if (window.innerWidth < 1024) {
      setIsMenuOpen(false);
    }
  };

  const menuIconVariants = {
    opened: {
      rotate: 90,
      scale: 1.2,
      transition: { duration: 0.2 },
    },
    closed: {
      rotate: 0,
      scale: 1,
      transition: { duration: 0.2 },
    },
  };

  const menuVariants = {
    opened: {
      opacity: 1,
      y: 0,
      display: "flex",
      transition: {
        y: { stiffness: 100, velocity: -100, type: "spring" },
        opacity: { duration: 0.3 },
      },
    },
    closed: {
      opacity: 0,
      y: "-100%",
      transition: {
        y: { stiffness: 100 },
        opacity: { duration: 0.3 },
      },
      transitionEnd: {
        display: "none",
      },
    },
  };

  return (
    <nav
      className="relative flex items-center justify-center p-4"
      style={{ minHeight: "64px" }}
    >
      <div className="absolute left-0 pl-4">
        <Image src={logo} alt="Logo" priority />
      </div>
      {/* Burger Icon – visible on mobile only */}
      <motion.div
        className="lg:hidden z-20 absolute right-4 cursor-pointer"
        onClick={() => setIsMenuOpen(!isMenuOpen)}
        variants={menuIconVariants}
        animate={isMenuOpen ? "opened" : "closed"}
      >
        <svg
          className="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth="2"
            d={isMenuOpen ? "M6 18L18 6M6 6l12 12" : "M4 6h16M4 12h16M4 18h16"}
          ></path>
        </svg>
      </motion.div>
      {/* Menu Container */}
      <motion.div
        variants={menuVariants}
        initial="closed"
        animate={isMenuOpen ? "opened" : "closed"}
        className="menu-container absolute md:top-auto md:relative md:flex md:flex-row md:items-center md:space-x-4"
      >
        {sections.map((section) => (
          <div
            key={section}
            className="flex items-center"
            onMouseEnter={() => setHoveredSection(section)}
            onMouseLeave={() => setHoveredSection(null)}
          >
            <div
              className={`h-4 w-4 rounded-full cursor-pointer transition duration-800 ease-in-out ${
                activeSection === section
                  ? "bg-green-500"
                  : hoveredSection === section
                  ? "bg-gray-500"
                  : "bg-transparent border-2 border-black"
              }`}
              onClick={() => handleSectionClick(section)}
            />
            <button
              className={`py-2 px-4 ${
                section === "Contact"
                  ? "text-white font-bold rounded-lg px-2 mx-2 py-0 bg-green-700"
                  : "text-black"
              }`}
              onClick={() => handleSectionClick(section)}
            >
              {section}
            </button>
          </div>
        ))}
      </motion.div>
    </nav>
  );
};

export default NavBar;

// ====== FILE: src\app\components\NavigationBar.tsx ======

"use client";

import React from "react";
import Image from "next/image";
import Link from "next/link";
import { clientLogout } from "@/app/lib/apolloClient";
import { useAuthStore } from "../lib/authStore";
import useCurrentUser from "../hooks/useCurrentUser";

const NavigationBar: React.FC = () => {
  const { isLoading } = useCurrentUser();
  const user = useAuthStore((state) => state.user);

  const handleLogout = () => {
    clientLogout();
  };

  return (
    <nav className="flex items-center justify-between p-4 bg-white shadow font-roboto-condensed uppercase">
      <Link href="/">
        <Image
          src="/logo.svg"
          alt="Enablment-tt Logo"
          width={200}
          height={40}
          style={{ cursor: "pointer" }}
        />
      </Link>
      <div className="flex-grow font-semibold text-lg mx-4 flex items-center justify-center">
        <Link href="/issuesPage" className="mr-4">
          Issues
        </Link>
        <Link href="/adminPage" className="mr-4">
          Admin
        </Link>
        <Link href="/timeKeeper">Timekeeper</Link>
      </div>
      <div>
        <div>
          <div
            className={
              user
                ? "bg-gray-800 text-white px-4 m-1 rounded"
                : "text-md text-gray-500"
            }
          >
            {user
              ? user.email
              : isLoading
              ? "Loading user data..."
              : "Not logged in"}
          </div>
        </div>
        <button
          className="bg-black text-white rounded hover:bg-gray-800 font-bold py-1 px-4 float-right font-roboto-condensed uppercase"
          style={{ fontSize: "12px" }}
          onClick={handleLogout}
        >
          Logout
        </button>
      </div>
    </nav>
  );
};

export default NavigationBar;

// ====== FILE: src\app\components\peopleSection.tsx ======

"use client";

import React from "react";
import Image from "next/image";

interface Person {
  name: string;
  roles: string[];
  images: [string, string];
}

const peopleData: Person[] = [
  {
    name: "Gustav Duus",
    images: ["/members/ceo_1.jpg", "/members/ceo_2.jpg"],
    roles: ["CEO", "Co-Founder"],
  },
  {
    name: "Joakim Larsen",
    images: ["/members/m_1.jpg", "/members/m_2.jpg"],
    roles: ["Co-Founder"],
  },
  {
    name: "George Aftincai",
    images: ["/members/gerorge_1.jpg", "/members/gerorge_2.jpg"],
    roles: ["Front-end"],
  },
  {
    name: "Riccardo Conti",
    images: ["/members/ricardo_1.jpg", "/members/ricardo_2.jpg"],
    roles: ["Front-end", "Mobile"],
  },
  {
    name: "Sam Hakimane",
    images: ["/members/sam_1.jpg", "/members/sam_2.jpg"],
    roles: ["Back-end"],
  },
  {
    name: "Jedrzej Lagodzinski",
    images: ["/members/j_1.jpg", "/members/j_2.jpg"],
    roles: ["Front-end"],
  },
  {
    name: "David Lin",
    images: ["/members/david_1.jpg", "/members/david_2.jpg"],
    roles: ["Front-end", "Design"],
  },
];

interface PeopleSectionProps {
  isActive: boolean;
}

const PeopleSection: React.FC<PeopleSectionProps> = ({ isActive }) => {
  if (!isActive) return null;
  return (
    <div className="p-4">
      <h2 className="text-3xl font-pt-sans-bold-900 mb-4 mx-4">People</h2>
      <div className="people-section grid grid-cols-1 sm:grid-cols-3 gap-4 p-4">
        {peopleData.map((person, index) => (
          <PersonCard key={index} person={person} />
        ))}
      </div>
    </div>
  );
};

interface PersonCardProps {
  person: Person;
}

type RoleIconMappingType = {
  [roleName: string]: string;
};

const roleIconMapping: RoleIconMappingType = {
  CEO: "ceo.svg",
  "Co-Founder": "founder.svg",
  "Front-end": "front.svg",
  Mobile: "mobile.svg",
  "Back-end": "back.svg",
  Design: "design.svg",
};

const getIconPath = (role: string): string => {
  return `/icons/${roleIconMapping[role] || "default-icon.svg"}`;
};

const PersonCard: React.FC<PersonCardProps> = ({ person }) => {
  const [isHovered, setIsHovered] = React.useState(false);
  return (
    <div
      className="person-card cursor-pointer overflow-hidden relative w-full h-auto shadow-lg"
      onMouseEnter={() => setIsHovered(true)}
      onMouseLeave={() => setIsHovered(false)}
    >
      <div
        className="relative w-full md:w-auto lg:w-full aspect-w-1 aspect-h-1"
        style={{ paddingTop: "calc(512 / 342 * 100%)" }}
      >
        <div
          className={`absolute inset-0 transition-opacity duration-700 ease-in-out ${
            isHovered ? "opacity-0" : "opacity-100"
          }`}
          style={{ paddingTop: "calc(512 / 342 * 100%)" }}
        >
          <Image
            src={person.images[0]}
            alt={`${person.name} - Base`}
            fill
            sizes="(max-width: 768px) 100vw, 50vw"
            className="rounded-lg"
          />
        </div>
        <div
          className={`absolute inset-0 transition-opacity duration-700 ease-in-out ${
            isHovered ? "opacity-100" : "opacity-0"
          }`}
          style={{ paddingTop: "calc(512 / 342 * 100%)" }}
        >
          <Image
            src={person.images[1]}
            alt={`${person.name} - Hover`}
            fill
            sizes="(max-width: 768px) 100vw, 50vw"
            className="rounded-lg"
          />
        </div>
      </div>
      <div className="absolute inset-0 flex flex-col justify-end p-4 rounded-lg">
        <div
          style={{ width: "fit-content" }}
          className="bg-black bg-opacity-40 lg:p-2 sm:p-1"
        >
          <h3 className="text-white lg:text-xl md:text-sm font-bold">
            {person.name}
          </h3>
        </div>
        {person.roles.map((role, index) => (
          <div key={index} style={{ width: "fit-content" }}>
            <div className="bg-black bg-opacity-40 flex items-center">
              <div className="relative mr-1 flex justify-center items-center w-8 h-8 sm:w-[3vw] sm:h-[3vw] lg:w-[2vw] lg:h-[2vw] md:w-[3vw] md:h-[3vw]">
                <Image
                  src={getIconPath(role)}
                  alt={`${role} icon`}
                  fill
                  className="filter invert"
                />
              </div>
              <span className="text-white lg:text-lg md:text-sm mr-2">
                {role}
              </span>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

export default PeopleSection;

// ====== FILE: src\app\components\ProjectRateSelectors.tsx ======

"use client";

import React from "react";
import ProjectSelector from "./ProjectSelector";
import RateSelector from "./RateSelector";
import { ApolloError } from "@apollo/client";
import { formatTimeFromMilliseconds } from "../utils/timeUtils";

interface Project {
  id: string;
  name: string;
  teamName: string;
}

interface Rate {
  id: string;
  name: string;
  rate: number;
}

interface ProjectRateSelectorsProps {
  userProjects: Project[];
  selectedProject: string | null;
  setSelectedProject: (projectId: string) => void;
  rates: Rate[];
  selectedRate: string | null;
  setSelectedRate: (rateId: string) => void;
  totalTimeLoading: boolean;
  totalTimeError: ApolloError | undefined;
  totalTime: number;
}

const ProjectRateSelectors: React.FC<ProjectRateSelectorsProps> = ({
  userProjects,
  selectedProject,
  setSelectedProject,
  rates,
  selectedRate,
  setSelectedRate,
  totalTimeLoading,
  totalTimeError,
  totalTime,
}) => {
  return (
    <div className="mt-6">
      <div className="mb-4">
        <ProjectSelector
          projects={userProjects}
          selectedProject={selectedProject ?? ""}
          onProjectChange={setSelectedProject}
        />
      </div>
      <div className="mb-4">
        <RateSelector
          rates={rates}
          selectedRate={selectedRate ?? ""}
          onRateChange={setSelectedRate}
        />
      </div>
      <div className="mt-4">
        {totalTimeLoading ? (
          <p>Loading total time...</p>
        ) : totalTimeError ? (
          <p>Error loading total time: {totalTimeError.message}</p>
        ) : (
          <p>
            Your time on project so far: {formatTimeFromMilliseconds(totalTime)}
          </p>
        )}
      </div>
    </div>
  );
};

export default ProjectRateSelectors;

// ====== FILE: src\app\components\ProjectSelector.tsx ======

"use client";

import React from "react";

type ProjectSelectorProps = {
  projects: { id: string; name: string; teamName: string }[];
  selectedProject: string;
  onProjectChange: (projectId: string) => void;
  className?: string;
};

const ProjectSelector: React.FC<ProjectSelectorProps> = ({
  projects,
  selectedProject,
  onProjectChange,
}) => {
  return (
    <select
      value={selectedProject}
      onChange={(e) => onProjectChange(e.target.value)}
      className="form-input block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
    >
      <option value="" disabled>
        Select a project
      </option>
      {projects.map((project) => (
        <option key={project.id} value={project.id}>
          {project.name} (Team: {project.teamName})
        </option>
      ))}
    </select>
  );
};

export default ProjectSelector;

// ====== FILE: src\app\components\RateSelector.tsx ======

"use client";

import React from "react";

type RateSelectorProps = {
  rates: { id: string; name: string; rate: number }[];
  selectedRate: string;
  onRateChange: (rateId: string) => void;
};

const RateSelector: React.FC<RateSelectorProps> = ({
  rates,
  selectedRate,
  onRateChange,
}) => {
  return (
    <select
      value={selectedRate}
      onChange={(e) => onRateChange(e.target.value)}
      className="form-input block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
    >
      <option value="" disabled>
        Select a rate
      </option>
      {rates.map((rate) => (
        <option key={rate.id} value={rate.id}>
          {rate.name} ({rate.rate})
        </option>
      ))}
    </select>
  );
};

export default RateSelector;

// ====== FILE: src\app\components\sectionAnimation.tsx ======

"use client";

import React from "react";
import { motion } from "framer-motion";
import SectionWrapper from "@/app/components/sectionWrapper";

interface SectionAnimationProps {
  section: string;
  navigationDirection: "forward" | "backward";
  videoSrc?: string;
}

const SectionAnimation: React.FC<SectionAnimationProps> = ({
  section,
  navigationDirection,
  videoSrc,
}) => {
  return (
    <motion.div
      key={section}
      className="w-full"
      initial={{
        opacity: 0,
        x: navigationDirection === "forward" ? 100 : -100,
      }}
      animate={{
        opacity: 1,
        x: 0,
      }}
      exit={{
        opacity: 0,
        x: navigationDirection === "forward" ? -100 : 100,
      }}
      transition={{
        type: "spring",
        stiffness: 80,
        damping: 15,
        mass: 1,
      }}
    >
      <SectionWrapper
        id={section}
        content={section}
        color={"bg-gray-200"}
        videoSrc={videoSrc}
      />
    </motion.div>
  );
};

export default SectionAnimation;

// ====== FILE: src\app\components\sectionWrapper.tsx ======

"use client";

import React from "react";
import PeopleSection from "@/app/components/peopleSection";
import AboutSection from "@/app/components/aboutSection";
import ServicesSection from "@/app/components/servicesSection";

interface SectionProps {
  id: string;
  content: string;
  color: string;
  videoSrc?: string;
}

const SectionWrapper: React.FC<SectionProps> = ({
  id,
  content,
  color,
  videoSrc,
}) => {
  return (
    <div
      className={`section border-2 border-green-600 rounded-tl-3xl rounded-tr-3xl shadow-lg ${color} responsive-section`}
      style={{
        width: "100%",
        boxSizing: "border-box",
      }}
    >
      {id === "People" ? (
        <div
          className="overflow-y-auto"
          style={{ maxHeight: "calc(100vh - 200px)" }}
        >
          <PeopleSection isActive={true} />
        </div>
      ) : id === "About" ? (
        <AboutSection />
      ) : id === "Services" ? (
        <ServicesSection />
      ) : videoSrc ? (
        <div className="w-full h-full">
          <video
            className="video w-full h-full overflow-hidden rounded-tl-3xl rounded-tr-3xl object-cover"
            autoPlay
            loop
            muted
            playsInline
          >
            <source src={videoSrc} type="video/mp4" />
            Your browser does not support the video tag.
          </video>
          <div className="flex overlay-text lg:bottom-48 p-4 lg:relative md:flex ">
            <h2 className="lg:text-4xl font-bold text-white p-4 bg-black bg-opacity-50 rounded-lg sm:text-lg">
              We enable Collaborators
              <br /> to create delightful technical solutions
            </h2>
          </div>
        </div>
      ) : (
        <>
          <h2 className="text-2xl font-bold mb-4">{content}</h2>
          <p className="text-gray-700">
            Placeholder content for the {content} section.
          </p>
        </>
      )}
    </div>
  );
};

export default SectionWrapper;

// ====== FILE: src\app\components\servicesSection.tsx ======

"use client";

import React from "react";
import Image from "next/image";

interface IFeature {
  name: string;
  icon: string;
}

interface IService {
  title: string;
  description: string[];
  icon: string;
  features?: IFeature[];
  imageUrl: string;
}

const servicesData: IService[] = [
  {
    title: "Digital Product Development",
    description: [
      "Do you know the feeling of navigating a website or a mobile application and it is either hideous or you are getting lost in the pages all the time?",
      "UI and UX is the art of creating beautiful applications that offer a smooth user experience whether it is a web or mobile application.",
      "Both are essential for creating a successful application. UI design ensures that the application looks visually appealing and attractive to users, while UX design ensures that the application is intuitive and easy to use.",
      "Let us enable you to balance both.",
    ],
    icon: "/icons/digital.svg",
    imageUrl: "/images/dpd.jpg",
    features: [
      {
        name: "E-commerce & Websites",
        icon: "/icons/e-commerce.svg",
      },
      {
        name: "Mobile apps & Web applications",
        icon: "/icons/mobile.svg",
      },
      {
        name: "Digital Solutions & Platforms",
        icon: "/icons/platforms.svg",
      },
    ],
  },
  {
    title: "Climate Reporting",
    description: [
      "Searching for the right data? Preparing to report scope 1, 2 or 3? Or are you looking for internal tracking to make data-driven decisions to lower your climate footprint?",
      "At Enablment, we have the technical skills to integrate with the correct data sources and align that data for trustworthy reporting. We can set up automated reporting flows from multiple data sources for internal tracking.",
    ],
    icon: "/icons/climate.svg",
    imageUrl: "/images/climate.jpg",
  },
  {
    title: "Insights through Data",
    description: [
      "On the journey of digitalization, automating and optimizing processes and data collection create the best fundamentals for an effective digital solution.",
      "Luckily, we are more than stoked to help you with following.",
    ],
    icon: "/icons/data.svg",
    imageUrl: "/images/data.jpg",
  },
  {
    title: "Data Consolidation (Cloud)",
    description: [
      "Is it difficult, and time consuming gathering data, and structuring it for data analytics/insight?",
      "This is the first step within data analytics and all companies will inevitably go through this transformation at some point. Once implemented there will be a consistent and reliable data foundation for all data analysis. Plus a setup like this is fully automated.",
    ],
    icon: "/icons/cloud.svg",
    imageUrl: "/images/cloud.jpg",
  },
  {
    title: "Business Intelligence (BI)",
    description: [
      "Do you have a database that is automatically sourcing the data for you? And is your data then, consequently, consolidated in one place and might even be structured? Now you want insight from your data?",
      "This is Business Intelligence. We conduct a data analysis and transform your data, then we create dashboards to visualize the insight.",
    ],
    icon: "/icons/bi.svg",
    imageUrl: "/images/bi.jpg",
  },
  {
    title: "Machine Learning & Artificial Intelligence (ML & AI)",
    description: [
      "Is your decision-making process supplemented with insight and a descriptive data analysis through BI? Are you ready to let a data model offer you suggestions?",
      "Certain trends and causalities that might not be visible to the human eye or the data input is simply too big. This is when you move from the descriptive to the prescriptive data analysis. A machine learning model can highlight causalities and forecast development.",
    ],
    icon: "/icons/ai.svg",
    imageUrl: "/images/AI-ML.jpg",
  },
];

const ServicesSection: React.FC = () => {
  return (
    <div className="space-y-8 p-4 sm:p-6">
      <h2 className="text-3xl font-pt-sans-bold-900 mb-4">Services</h2>
      <div
        style={{
          maxHeight: "calc(100vh - 300px)",
          overflowY: "auto",
        }}
      >
        {servicesData.map((service, index) => (
          <div key={index} className="mb-6">
            <div className="flex flex-wrap items-stretch shadow-lg rounded-lg overflow-hidden lg:justify-start sm:justify-center lg:flex-nowrap space-x-4">
              <div className="relative w-full flex-grow tablet:flex-grow-0 md:w-1/2  services-image-container">
                <Image
                  src={service.imageUrl}
                  alt={`${service.title}`}
                  layout="fill"
                  objectFit="cover"
                  sizes="(min-width: 768px) 50vw, 100vw"
                />
              </div>
              <div className="text-container lg:w-1/2 sm:mt-4">
                <div className="flex items-center space-x-2">
                  <Image
                    src={service.icon}
                    alt={`${service.title} Icon`}
                    width={24}
                    height={24}
                  />
                  <h3 className="text-2xl font-semibold mb-2">
                    {service.title}
                  </h3>
                </div>
                {service.description.map((paragraph, pIndex) => (
                  <p
                    key={pIndex}
                    style={{ lineHeight: "1.4" }}
                    className="text-lg mb-3"
                  >
                    {paragraph}
                  </p>
                ))}
                {service.features && (
                  <div className="flex flex-col space-y-2 mt-4">
                    {service.features.map((feature, fIndex) => (
                      <div
                        key={fIndex}
                        className="flex items-center space-x-2 "
                      >
                        <Image
                          src={feature.icon}
                          alt={`${feature.name} Icon`}
                          width={20}
                          height={20}
                        />
                        <span style={{ lineHeight: "1.4" }} className="text-lg">
                          {feature.name}
                        </span>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

export default ServicesSection;

// ====== FILE: src\app\components\TimerControls.tsx ======

"use client";
import React from "react";

interface TimerControlsProps {
  isRunning: boolean;
  handleStartStop: () => void;
  handleReset: () => void;
  handleSubmit: (e: React.FormEvent<HTMLFormElement>) => void;
  disabledStartPause: boolean;
  disabledReset: boolean;
  disabledSubmit: boolean;
}

const TimerControls: React.FC<TimerControlsProps> = ({
  isRunning,
  handleStartStop,
  handleReset,
  handleSubmit,
  disabledStartPause,
  disabledReset,
  disabledSubmit,
}) => {
  return (
    <form onSubmit={handleSubmit}>
      <div className="flex justify-center mt-auto py-6">
        <button
          type="button"
          onClick={handleStartStop}
          className={`px-6 py-6 ${
            isRunning ? "bg-red-500" : "bg-green-500"
          } text-white text-2xl rounded-full`}
          disabled={disabledStartPause}
        >
          {isRunning ? "Pause" : "Start"}
        </button>
        <button
          type="button"
          onClick={handleReset}
          className="px-6 py-8 bg-yellow-500 text-white text-2xl rounded-full ml-4"
          disabled={disabledReset}
        >
          Reset
        </button>
        <button
          type="submit"
          className="px-3 py-8 bg-blue-500 text-white text-2xl rounded-full ml-4"
          disabled={disabledSubmit}
        >
          Submit
        </button>
      </div>
    </form>
  );
};

export default TimerControls;

// ====== FILE: src\app\components\TimerDisplay.tsx ======

import React from "react";
import DatePicker from "react-datepicker";
import "react-datepicker/dist/react-datepicker.css";
import {
  formatDateForDisplay,
  formatTimeFromISOString,
} from "../utils/timeUtils";
import { formatISO } from "date-fns";

interface TimerDisplayProps {
  isRunning: boolean;
  displayTime: string;
  initialStartTime: Date | null;
  handleDateChange: (date: Date | null) => void;
}

const TimerDisplay: React.FC<TimerDisplayProps> = ({
  isRunning,
  displayTime,
  initialStartTime,
  handleDateChange,
}) => {
  return (
    <div className="flex flex-col items-center justify-center">
      <div
        className={`clock-icon h-6 w-6 ${
          isRunning ? "animate-spin" : ""
        } text-gray-500`}
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <circle cx="12" cy="12" r="10" />
          <line x1="12" y1="12" x2="12" y2="8" />
          <line
            x1="12"
            y1="12"
            x2="16"
            y2="12"
            className={isRunning ? "animate-spin" : ""}
          />
        </svg>
      </div>
      <div className="text-7xl font-digital text-black flex items-center justify-center">
        {displayTime}
      </div>
      <div className="mb-2">
        Started at:{" "}
        {initialStartTime
          ? formatDateForDisplay(initialStartTime) +
            " " +
            formatTimeFromISOString(formatISO(initialStartTime))
          : "Not Started"}
      </div>
      <div className="flex justify-center">
        <DatePicker
          inline
          id="startDate"
          selected={initialStartTime || new Date()}
          onChange={handleDateChange}
          showTimeSelect
          dateFormat="MMMM d, yyyy HH:mm"
          timeIntervals={10}
          className="form-input block w-52 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
        />
      </div>
    </div>
  );
};

export default TimerDisplay;

// ====== FILE: src\app\components\UserSelector.tsx ======

"use client";

const UserSelector: React.FC<{
  users: { id: string; email: string }[];
  selectedUser: string;
  onUserChange: (userId: string) => void;
}> = ({ users, selectedUser, onUserChange }) => {
  return (
    <select
      value={selectedUser}
      onChange={(e) => onUserChange(e.target.value)}
      className="form-input block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
    >
      <option value="" disabled>
        Select a user
      </option>
      {users.map((user) => (
        <option key={user.id} value={user.id}>
          {user.email}
        </option>
      ))}
    </select>
  );
};
export default UserSelector;

// ====== FILE: src\app\dbSynch\page.tsx ======

"use client";

import React, { useState } from "react";
import { useQuery, useMutation, gql } from "@apollo/client";
import { motion } from "framer-motion";
import { SYNC_DATABASE_MUTATION } from "@/app/graphql/authOperations";

export interface SimpleTeam {
  id: string;
  name: string;
}

export interface SimpleProject {
  id: string;
  name: string;
  teamId: string;
}

export interface DBSyncIssue {
  id: string;
  title: string;
  teamKey?: string;
  projectId?: string;
  projectName?: string;
  state?: string;
  labels?: SimpleLabel[];
}

export interface SimpleLabel {
  id: string;
  name: string;
  color: string;
}

// GraphQL queries to fetch data
const GET_TEAMS = gql`
  query GetAllSimpleTeams {
    getAllSimpleTeams {
      id
      name
    }
  }
`;

const GET_PROJECTS = gql`
  query GetProjects {
    projects {
      id
      name
      teamId
    }
  }
`;

const GET_ISSUES = gql`
  query GetIssues {
    issues {
      id
      title
      teamKey
      projectId
      projectName
      state
      labels {
        id
        name
        color
      }
    }
  }
`;

const DBSyncPage: React.FC = () => {
  const [syncStatus, setSyncStatus] = useState<string>("");
  const [isSyncing, setIsSyncing] = useState<boolean>(false);
  const [error, setError] = useState<string | null>(null);
  const [showSuccess, setShowSuccess] = useState<boolean>(false);
  const [syncDetails, setSyncDetails] = useState<string[]>([]);
  const [activeTab, setActiveTab] = useState<string>("teams");

  // Queries to fetch data that will be affected by the sync
  const {
    loading: teamsLoading,
    error: teamsError,
    data: teamsData,
    refetch: refetchTeams,
  } = useQuery(GET_TEAMS);

  const {
    loading: projectsLoading,
    error: projectsError,
    data: projectsData,
    refetch: refetchProjects,
  } = useQuery(GET_PROJECTS);

  const {
    loading: issuesLoading,
    error: issuesError,
    data: issuesData,
    refetch: refetchIssues,
  } = useQuery(GET_ISSUES);

  // GraphQL mutation for database sync
  const [syncDatabase] = useMutation(SYNC_DATABASE_MUTATION, {
    onCompleted: (data) => {
      setSyncStatus("Database synchronization completed successfully!");
      setSyncDetails((prev) => [
        ...prev,
        "Synchronization completed!",
        `Timestamp: ${
          data.synchronizeDatabase.timestamp || new Date().toISOString()
        }`,
      ]);
      setShowSuccess(true);

      // Refetch data to show updated state
      Promise.all([refetchTeams(), refetchProjects(), refetchIssues()]);
      setIsSyncing(false);
    },
    onError: (error) => {
      const errorMessage =
        error.message || "An error occurred during synchronization";

      setError(errorMessage);
      setSyncStatus("Database synchronization failed");
      setSyncDetails((prev) => [...prev, `Error: ${errorMessage}`]);
      setIsSyncing(false);
    },
  });

  // Function to trigger database synchronization
  const handleSync = () => {
    setIsSyncing(true);
    setSyncStatus("Starting comprehensive database synchronization...");
    setError(null);
    setShowSuccess(false);
    setSyncDetails([
      "Initializing synchronization...",
      "Connecting to Linear API...",
    ]);

    // Add progress updates for better UX - these are simulated since the actual work happens on the backend
    setTimeout(() => {
      if (isSyncing) {
        setSyncDetails((prev) => [
          ...prev,
          "Synchronizing teams from Linear...",
        ]);
      }
    }, 1000);

    setTimeout(() => {
      if (isSyncing) {
        setSyncDetails((prev) => [
          ...prev,
          "Synchronizing projects from Linear...",
        ]);
      }
    }, 3000);

    setTimeout(() => {
      if (isSyncing) {
        setSyncDetails((prev) => [
          ...prev,
          "Synchronizing issues and labels from Linear...",
        ]);
      }
    }, 5000);

    setTimeout(() => {
      if (isSyncing) {
        setSyncDetails((prev) => [...prev, "Cleaning up orphaned records..."]);
      }
    }, 7000);

    // Call the GraphQL mutation
    syncDatabase();
  };

  // Animation variants
  const containerVariants = {
    hidden: { opacity: 0 },
    visible: {
      opacity: 1,
      transition: { staggerChildren: 0.05 },
    },
  };

  const itemVariants = {
    hidden: { opacity: 0, y: 10 },
    visible: {
      opacity: 1,
      y: 0,
      transition: { duration: 0.3 },
    },
  };

  const isLoading = teamsLoading || projectsLoading || issuesLoading;
  const hasError = teamsError || projectsError || issuesError;

  const renderTabContent = () => {
    switch (activeTab) {
      case "teams":
        return (
          <motion.div
            variants={containerVariants}
            initial="hidden"
            animate="visible"
            className="border rounded-lg overflow-hidden h-full"
          >
            <div className="bg-gray-100 px-4 py-3 border-b">
              <h3 className="text-lg font-medium">Teams</h3>
              <p className="text-sm text-gray-500">
                Total: {teamsData?.getAllSimpleTeams?.length || 0}
              </p>
            </div>
            <div className="p-4 overflow-y-auto" style={{ maxHeight: "400px" }}>
              {teamsData?.getAllSimpleTeams?.length > 0 ? (
                <ul className="space-y-2">
                  {teamsData.getAllSimpleTeams.map(
                    (team: SimpleTeam, index: number) => (
                      <motion.li
                        key={team.id}
                        variants={itemVariants}
                        custom={index}
                        className="bg-gray-50 p-3 rounded-lg hover:bg-gray-100 transition-colors"
                      >
                        <div className="font-medium">{team.name}</div>
                        <div className="text-sm text-gray-500 mt-1">
                          ID: {team.id}
                        </div>
                      </motion.li>
                    )
                  )}
                </ul>
              ) : (
                <p className="text-gray-500 text-center py-8">
                  No teams available
                </p>
              )}
            </div>
          </motion.div>
        );

      case "projects":
        return (
          <motion.div
            variants={containerVariants}
            initial="hidden"
            animate="visible"
            className="border rounded-lg overflow-hidden h-full"
          >
            <div className="bg-gray-100 px-4 py-3 border-b">
              <h3 className="text-lg font-medium">Projects</h3>
              <p className="text-sm text-gray-500">
                Total: {projectsData?.projects?.length || 0}
              </p>
            </div>
            <div className="p-4 overflow-y-auto" style={{ maxHeight: "400px" }}>
              {projectsData?.projects?.length > 0 ? (
                <ul className="space-y-2">
                  {projectsData.projects.map(
                    (project: SimpleProject, index: number) => (
                      <motion.li
                        key={project.id}
                        variants={itemVariants}
                        custom={index}
                        className="bg-gray-50 p-3 rounded-lg hover:bg-gray-100 transition-colors"
                      >
                        <div className="font-medium">{project.name}</div>
                        <div className="text-sm text-gray-500 mt-1">
                          ID: {project.id}
                          <br />
                          Team ID: {project.teamId}
                        </div>
                      </motion.li>
                    )
                  )}
                </ul>
              ) : (
                <p className="text-gray-500 text-center py-8">
                  No projects available
                </p>
              )}
            </div>
          </motion.div>
        );

      case "issues":
        return (
          <motion.div
            variants={containerVariants}
            initial="hidden"
            animate="visible"
            className="border rounded-lg overflow-hidden h-full"
          >
            <div className="bg-gray-100 px-4 py-3 border-b">
              <h3 className="text-lg font-medium">Issues</h3>
              <p className="text-sm text-gray-500">
                Total: {issuesData?.issues?.length || 0}
              </p>
            </div>
            <div className="p-4 overflow-y-auto" style={{ maxHeight: "400px" }}>
              {issuesData?.issues?.length > 0 ? (
                <ul className="space-y-2">
                  {issuesData.issues.map(
                    (issue: DBSyncIssue, index: number) => (
                      <motion.li
                        key={issue.id}
                        variants={itemVariants}
                        custom={index}
                        className="bg-gray-50 p-3 rounded-lg hover:bg-gray-100 transition-colors"
                      >
                        <div className="font-medium">{issue.title}</div>
                        <div className="text-sm text-gray-500 mt-1">
                          Project: {issue.projectName || "N/A"}
                          <br />
                          State: {issue.state || "N/A"}
                        </div>
                        {issue.labels && issue.labels.length > 0 && (
                          <div className="flex flex-wrap gap-1 mt-2">
                            {issue.labels.map((label) => (
                              <span
                                key={label.id}
                                className="text-xs px-2 py-1 rounded-full text-white"
                                style={{
                                  backgroundColor: label.color || "#888",
                                }}
                              >
                                {label.name}
                              </span>
                            ))}
                          </div>
                        )}
                      </motion.li>
                    )
                  )}
                </ul>
              ) : (
                <p className="text-gray-500 text-center py-8">
                  No issues available
                </p>
              )}
            </div>
          </motion.div>
        );

      case "sync":
        return (
          <motion.div
            variants={containerVariants}
            initial="hidden"
            animate="visible"
            className="border rounded-lg overflow-hidden h-full"
          >
            <div className="bg-gray-100 px-4 py-3 border-b">
              <h3 className="text-lg font-medium">Sync Details</h3>
            </div>
            <div className="p-4 overflow-y-auto" style={{ maxHeight: "400px" }}>
              {syncDetails.length > 0 ? (
                <ul className="space-y-2">
                  {syncDetails.map((detail, index) => (
                    <motion.li
                      key={index}
                      variants={itemVariants}
                      custom={index}
                      className="flex items-start gap-2"
                    >
                      <div className="text-green-500 mt-1">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          className="h-4 w-4"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            strokeLinecap="round"
                            strokeLinejoin="round"
                            strokeWidth={2}
                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                          />
                        </svg>
                      </div>
                      <span
                        className={
                          detail.startsWith("Error")
                            ? "text-red-600"
                            : "text-gray-700"
                        }
                      >
                        {detail}
                      </span>
                    </motion.li>
                  ))}
                </ul>
              ) : (
                <p className="text-gray-500 text-center py-8">
                  No synchronization has been run yet
                </p>
              )}
            </div>
          </motion.div>
        );

      default:
        return null;
    }
  };

  return (
    <>
      <div className="container mx-auto p-6 font-roboto-condensed">
        <motion.div
          className="bg-white shadow-lg rounded-lg overflow-hidden"
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5 }}
        >
          <div className="bg-black text-white p-6">
            <h1 className="text-3xl font-bold">
              Linear Database Synchronization
            </h1>
            <p className="text-gray-300 mt-2">
              Synchronize your entire database with Linear - teams, projects,
              and issues
            </p>
          </div>

          <div className="p-6">
            <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8">
              <div>
                <h2 className="text-xl font-semibold">
                  Current Database State
                </h2>
                <div className="text-gray-600 mt-1">
                  <span className="inline-block mr-4">
                    <span className="font-semibold">Teams:</span>{" "}
                    {teamsData?.getAllSimpleTeams?.length || 0}
                  </span>
                  <span className="inline-block mr-4">
                    <span className="font-semibold">Projects:</span>{" "}
                    {projectsData?.projects?.length || 0}
                  </span>
                  <span className="inline-block">
                    <span className="font-semibold">Issues:</span>{" "}
                    {issuesData?.issues?.length || 0}
                  </span>
                </div>
              </div>

              <button
                onClick={handleSync}
                disabled={isSyncing || isLoading}
                className={`flex items-center gap-2 px-6 py-3 rounded-lg text-white font-medium transition-all ${
                  isSyncing || isLoading
                    ? "bg-gray-400 cursor-not-allowed"
                    : "bg-black hover:bg-gray-800"
                }`}
              >
                {isSyncing ? (
                  <>
                    <svg
                      className="animate-spin h-5 w-5 text-white"
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 24 24"
                    >
                      <circle
                        className="opacity-25"
                        cx="12"
                        cy="12"
                        r="10"
                        stroke="currentColor"
                        strokeWidth="4"
                      ></circle>
                      <path
                        className="opacity-75"
                        fill="currentColor"
                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                      ></path>
                    </svg>
                    Synchronizing...
                  </>
                ) : (
                  <>
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      className="h-5 w-5"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        strokeWidth={2}
                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                      />
                    </svg>
                    Synchronize Database
                  </>
                )}
              </button>
            </div>

            {syncStatus && (
              <motion.div
                className={`mb-6 p-4 rounded-lg ${
                  error
                    ? "bg-red-100 border-l-4 border-red-500"
                    : showSuccess
                    ? "bg-green-100 border-l-4 border-green-500"
                    : "bg-blue-100 border-l-4 border-blue-500"
                }`}
                initial={{ opacity: 0, y: -20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.3 }}
              >
                <p
                  className={`${
                    error
                      ? "text-red-700"
                      : showSuccess
                      ? "text-green-700"
                      : "text-blue-700"
                  } font-medium`}
                >
                  {syncStatus}
                </p>
                {error && <p className="text-red-500 mt-2">{error}</p>}
              </motion.div>
            )}

            {isLoading ? (
              <div className="text-center py-10">
                <svg
                  className="animate-spin h-10 w-10 text-black mx-auto"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                >
                  <circle
                    className="opacity-25"
                    cx="12"
                    cy="12"
                    r="10"
                    stroke="currentColor"
                    strokeWidth="4"
                  ></circle>
                  <path
                    className="opacity-75"
                    fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                  ></path>
                </svg>
                <p className="mt-4 text-gray-600">
                  Loading database information...
                </p>
              </div>
            ) : hasError ? (
              <div className="bg-red-100 p-4 rounded-lg">
                <p className="text-red-700">
                  Error loading data:{" "}
                  {teamsError?.message || projectsError?.message}
                </p>
              </div>
            ) : (
              <>
                <div className="mb-6 border-b">
                  <nav className="flex overflow-x-auto">
                    <button
                      onClick={() => setActiveTab("teams")}
                      className={`whitespace-nowrap px-4 py-2 font-medium text-sm ${
                        activeTab === "teams"
                          ? "border-b-2 border-black text-black"
                          : "text-gray-500 hover:text-gray-700"
                      }`}
                    >
                      Teams
                    </button>
                    <button
                      onClick={() => setActiveTab("projects")}
                      className={`whitespace-nowrap px-4 py-2 font-medium text-sm ${
                        activeTab === "projects"
                          ? "border-b-2 border-black text-black"
                          : "text-gray-500 hover:text-gray-700"
                      }`}
                    >
                      Projects
                    </button>
                    <button
                      onClick={() => setActiveTab("issues")}
                      className={`whitespace-nowrap px-4 py-2 font-medium text-sm ${
                        activeTab === "issues"
                          ? "border-b-2 border-black text-black"
                          : "text-gray-500 hover:text-gray-700"
                      }`}
                    >
                      Issues
                    </button>
                    <button
                      onClick={() => setActiveTab("sync")}
                      className={`whitespace-nowrap px-4 py-2 font-medium text-sm ${
                        activeTab === "sync"
                          ? "border-b-2 border-black text-black"
                          : "text-gray-500 hover:text-gray-700"
                      }`}
                    >
                      Sync Details
                    </button>
                  </nav>
                </div>

                <div className="min-h-[400px]">{renderTabContent()}</div>
              </>
            )}
          </div>
        </motion.div>
      </div>
    </>
  );
};

export default DBSyncPage;

// ====== FILE: src\app\graphql\adminOperations.ts ======

import { gql } from "@apollo/client";

export const GET_USERS = gql`
  query GetUsers {
    users {
      id
      email
      role
      teams {
        id
        name
      }
    }
  }
`;

export const GET_SIMPLE_TEAMS = gql`
  query GetAllSimpleTeams {
    getAllSimpleTeams {
      id
      name
    }
  }
`;

export const UPDATE_USER_ROLE = gql`
  mutation UpdateUserRole($userId: Int!, $newRole: UserRole!) {
    updateUserRole(userId: $userId, newRole: $newRole) {
      id
      role
    }
  }
`;

export const ADD_USER_TO_TEAM = gql`
  mutation AddUserToTeam($userId: Int!, $teamId: String!) {
    addUserToTeam(userId: $userId, teamId: $teamId) {
      id
      email
    }
  }
`;

export const REMOVE_USER_FROM_TEAM = gql`
  mutation RemoveUserFromTeam($userId: Int!, $teamId: String!) {
    removeUserFromTeam(userId: $userId, teamId: $teamId) {
      id
      email
    }
  }
`;

// ====== FILE: src\app\graphql\authOperations.ts ======

import { gql } from "@apollo/client";

export const LOGIN_MUTATION = gql`
  mutation Login($input: SignInInput!) {
    login(input: $input) {
      access_token
      user {
        id
        email
        role
      }
    }
  }
`;

export const SIGNUP_MUTATION = gql`
  mutation SignUp($input: SignUpInput!) {
    signup(input: $input) {
      access_token
      user {
        id
        email
        role
      }
    }
  }
`;

export const ME_QUERY = gql`
  query Me {
    me {
      id
      email
    }
  }
`;

export const LOGOUT_MUTATION = gql`
  mutation Logout {
    logout {
      success
    }
  }
`;

export const SYNC_DATABASE_MUTATION = gql`
  mutation SyncDatabase {
    synchronizeDatabase {
      status
      message
      timestamp
    }
  }
`;

// ====== FILE: src\app\graphql\timeKeeperOperations.ts ======

import { gql } from "@apollo/client";

export const PROJECTS_QUERY = gql`
  query GetProjects {
    projects {
      id
      name
      teamId
    }
  }
`;

export const RATES_QUERY = gql`
  query GetRates($teamId: String!) {
    rates(teamId: $teamId) {
      id
      name
      rate
    }
  }
`;

export const TOTAL_TIME_QUERY = gql`
  query GetTotalTimeForUserProject($userId: Float!, $projectId: String!) {
    getTotalTimeForUserProject(userId: $userId, projectId: $projectId)
  }
`;

export const USER_PROJECTS_QUERY = gql`
  query GetUserProjects {
    users {
      id
      teams {
        name
        projects {
          id
          name
        }
      }
    }
  }
`;

export const CREATE_TIME_MUTATION = gql`
  mutation CreateTime($timeInputCreate: TimeInputCreate!) {
    createTime(timeInputCreate: $timeInputCreate) {
      id
      startTime
      endTime
      totalElapsedTime
    }
  }
`;

export const UPDATE_TIME_MUTATION = gql`
  mutation UpdateTime($timeInputUpdate: TimeInputUpdate!) {
    updateTime(timeInputUpdate: $timeInputUpdate) {
      id
      startTime
      endTime
      totalElapsedTime
    }
  }
`;

// ====== FILE: src\app\hooks\useCurrentUser.ts ======

"use client";

import { useQuery } from "@apollo/client";
import { ME_QUERY } from "@/app/graphql/authOperations";
import { useAuthStore } from "@/app/lib/authStore";

interface MeQueryResult {
  me: {
    id: number;
    email: string;
    role: string;
  } | null;
}

export const useCurrentUser = () => {
  const {
    user: storeUser,
    accessToken,
    isAuthenticated,
    setUser,
    logout,
  } = useAuthStore();

  const { data, loading, error, refetch } = useQuery<MeQueryResult>(ME_QUERY, {
    fetchPolicy: "network-only",
    skip: !accessToken,
    context: {
      credentials: "include",
    },
    onCompleted: (data) => {
      if (data?.me) {
        console.log("ME_QUERY successful, user data:", data.me);
        setUser(data.me);
        if (!isAuthenticated) useAuthStore.setState({ isAuthenticated: true });
      } else {
        console.log("ME_QUERY returned null user, logging out.");
        if (accessToken) {
          logout();
        }
      }
    },
    onError: (error) => {
      console.error("Error fetching current user:", error);

      const isAuthError =
        error.graphQLErrors.some(
          (gqlError) =>
            gqlError.extensions?.code === "UNAUTHORIZED" ||
            gqlError.message.includes("Unauthorized")
        ) || error.networkError?.message.includes("401");

      if (isAuthError && accessToken) {
        console.log("ME_QUERY failed with auth error, logging out.");
        logout();
      }

      if (
        (error.message.includes("not authenticated") ||
          error.message.includes("Invalid token") ||
          error.message.includes("Unauthorized") ||
          error.message.includes("No auth token found in cookies")) &&
        !storeUser
      ) {
        useAuthStore.getState().logout();
      }
    },
  });
  const derivedIsAuthenticated = !!accessToken;
  return {
    currentUser: storeUser || data?.me || null,
    isLoading: loading,
    isAuthenticated: derivedIsAuthenticated,
    error,
    refetch,
  };
};

export default useCurrentUser;

// ====== FILE: src\app\hooks\useFeedbackState.ts ======

// src/app/hooks/useFeedbackState.ts
import { useState } from "react";
import type { FeedbackState } from "../types";

export const useFeedbackState = () => {
  const [submissionSuccess, setSubmissionSuccess] = useState(false);
  const [submissionError, setSubmissionError] = useState("");
  const [dateAlertMessage, setDateAlertMessage] = useState<string | null>(null);
  const [resetMessage, setResetMessage] = useState(false);

  const showSuccessMessage = () => {
    setSubmissionSuccess(true);
    setTimeout(() => setSubmissionSuccess(false), 2000);
  };

  const showResetMessage = () => {
    setResetMessage(true);
    setTimeout(() => setResetMessage(false), 2000);
  };

  const showDateAlert = (message: string) => {
    setDateAlertMessage(message);
    setTimeout(() => setDateAlertMessage(null), 3000);
  };

  return {
    state: {
      submissionSuccess,
      submissionError,
      dateAlertMessage,
      resetMessage,
    } as FeedbackState,
    actions: {
      setSubmissionError,
      showSuccessMessage,
      showResetMessage,
      showDateAlert,
    },
  };
};

// ====== FILE: src\app\hooks\useTimeKeeperData.ts ======

import { useQuery } from "@apollo/client";
import { useEffect, useState } from "react";
import {
  PROJECTS_QUERY,
  USER_PROJECTS_QUERY,
} from "@/app/graphql/timeKeeperOperations";
import useStore from "@/app/lib/store";
import { useAuthStore } from "@/app/lib/authStore";

// Define interfaces for our expected data shapes:
export interface Project {
  id: string;
  name: string;
  teamId: string;
}

export interface ProjectsData {
  projects: Project[];
}

export interface Team {
  name: string;
  projects: Project[];
}

export interface User {
  id: string;
  teams: Team[];
}

export interface UserProjectsData {
  users: User[];
}

export interface UserProject {
  id: string;
  name: string;
  teamName: string;
}

const useTimeKeeperData = () => {
  const user = useAuthStore((state) => state.user);

  // Use typed queries
  const { data: projectsData } = useQuery<ProjectsData>(PROJECTS_QUERY);
  const { data: userProjectsData } = useQuery<UserProjectsData>(
    USER_PROJECTS_QUERY,
    {
      skip: !user,
    }
  );
  const { setProjects, setTeamId } = useStore();
  const [userProjects, setUserProjects] = useState<UserProject[]>([]);
  const [currentTeamId, setCurrentTeamId] = useState<string | undefined>(
    undefined
  );
  const selectedProject = useStore((state) => state.selectedProject);

  useEffect(() => {
    if (projectsData) {
      setProjects(projectsData.projects);
    }
  }, [projectsData, setProjects]);

  useEffect(() => {
    if (projectsData && selectedProject) {
      // Use the typed projects array
      const project = projectsData.projects.find(
        (p) => p.id === selectedProject
      );
      if (project) {
        setTeamId(project.teamId);
        setCurrentTeamId(project.teamId);
      }
    }
  }, [projectsData, selectedProject, setTeamId]);

  useEffect(() => {
    if (userProjectsData && user) {
      const currentUserId = user.id;
      const userInfo = userProjectsData.users.find(
        (u) => u.id === currentUserId
      );
      if (userInfo) {
        const projectsList: UserProject[] = userInfo.teams.flatMap((team) =>
          team.projects.map((project) => ({
            id: project.id,
            name: project.name,
            teamName: team.name,
          }))
        );
        setUserProjects(projectsList);
      }
    }
  }, [userProjectsData, user]);

  return { userProjects, currentTeamId };
};

export default useTimeKeeperData;

// ====== FILE: src\app\hooks\useTimekeeperHandlers.ts ======

import { formatISO } from "date-fns";
import type { TimerState, TimeEntry } from "../types";

interface HandlersConfig {
  timerState: TimerState & {
    initialStartTime: Date | null;
    elapsedBeforePause: number;
    pauseTimes: Date[];
    resumeTimes: Date[];
    calculateTotalActiveTime: () => number; // Use the function from useTimer
  };
  selectedProject: string;
  selectedRate: string;
  userId: string;
  createTimeEntry: (data: {
    startTime: string;
    projectId: string;
    userId: number;
    rateId: number;
    totalElapsedTime: number;
  }) => Promise<{ data: { createTime: TimeEntry } }>;
  updateTime: (options: {
    timeInputUpdate: { id: number; endTime: string; totalElapsedTime: number };
  }) => Promise<{ data: { updateTime: TimeEntry } }>;
  currentEntryId: number | null;
  setCurrentEntryId: (id: number | null) => void;
  showSuccessMessage: () => void;
  setSubmissionError: (error: string) => void;
  showDateAlert: (message: string) => void;
  showResetMessage: () => void;
}

export const useTimeKeeperHandlers = ({
  timerState,
  selectedProject,
  selectedRate,
  userId,
  createTimeEntry,
  updateTime,
  currentEntryId,
  setCurrentEntryId,
  showSuccessMessage,
  setSubmissionError,
  showDateAlert,
  showResetMessage,
}: HandlersConfig) => {
  const handleDateChange = (date: Date | null): void => {
    const now = new Date();
    if (date && date > now) {
      showDateAlert("Please select a current or past date/time.");
    } else {
      timerState.setStartTime(date);
    }
  };

  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {
    e.preventDefault();
    if (
      !timerState.initialStartTime ||
      !selectedProject ||
      !userId ||
      !selectedRate
    ) {
      console.error("Missing required data for time entry.");
      return;
    }

    try {
      const submissionTime = new Date();
      console.log("Submission time:", submissionTime.toISOString());

      // Use the calculation function from timerState
      const totalElapsedTimeMs = timerState.calculateTotalActiveTime();
      console.log(
        "Total elapsed time calculated for submission (ms):",
        totalElapsedTimeMs
      );
      console.log(
        "Total elapsed time in seconds:",
        Math.floor(totalElapsedTimeMs / 1000)
      );

      if (currentEntryId) {
        // Update existing time entry
        console.log("Updating existing time entry with ID:", currentEntryId);
        await updateTime({
          timeInputUpdate: {
            id: currentEntryId,
            endTime: formatISO(submissionTime),
            totalElapsedTime: totalElapsedTimeMs,
          },
        });
        console.log("Updated existing time entry ID:", currentEntryId);
      } else {
        // Create new time entry
        console.log("Creating new time entry with data:", {
          startTime: formatISO(timerState.initialStartTime),
          projectId: selectedProject,
          userId: parseFloat(userId),
          rateId: parseFloat(selectedRate),
          totalElapsedTime: totalElapsedTimeMs,
        });

        try {
          const result = await createTimeEntry({
            startTime: formatISO(timerState.initialStartTime),
            projectId: selectedProject,
            userId: parseFloat(userId),
            rateId: parseFloat(selectedRate),
            totalElapsedTime: totalElapsedTimeMs,
          });
          console.log(
            "Success creating time entry with minimal required fields:",
            JSON.stringify(result, null, 2)
          );

          if (result?.data?.createTime?.id) {
            setCurrentEntryId(result.data.createTime.id);
            console.log("Set current entry ID to:", result.data.createTime.id);
          }
        } catch (err) {
          console.error("Failed to create time entry:", err);
          throw err;
        }
      }

      showSuccessMessage();

      if (timerState.isRunning) {
        timerState.pause();
      }
    } catch (error: unknown) {
      if (error instanceof Error) {
        setSubmissionError(`Error with time entry: ${error.message}`);
      } else {
        setSubmissionError("Unknown error");
      }
      console.error("Error submitting time entry:", error);
    }
  };

  const handleReset = (): void => {
    timerState.reset();
    setCurrentEntryId(null);
    showResetMessage();
  };

  return {
    handleDateChange,
    handleSubmit,
    handleReset,
  };
};

// ====== FILE: src\app\hooks\useTimekeeperQueries.ts ======

import { useQuery, useMutation } from "@apollo/client";
import {
  RATES_QUERY,
  TOTAL_TIME_QUERY,
  CREATE_TIME_MUTATION,
  UPDATE_TIME_MUTATION,
} from "@/app/graphql/timeKeeperOperations";
import type { TimeEntry, Rate } from "../types";

interface CreateTimeData {
  startTime: string; // ISO String
  endTime?: string; // ISO String (Optional)
  projectId: string;
  userId: number;
  rateId: number;
  totalElapsedTime: number;
}

// Define the structure for the Apollo variables
interface CreateTimeMutationVariables {
  timeInputCreate: CreateTimeData; // <--- The nested object
}

export const useTimeKeeperQueries = (
  currentTeamId: string | undefined,
  selectedProject: string,
  userId: string
) => {
  const { data: ratesData } = useQuery<{ rates: Rate[] }>(RATES_QUERY, {
    variables: { teamId: currentTeamId },
    skip: !currentTeamId,
    context: { credentials: "include" },
  });

  const {
    data: totalTimeData,
    loading: totalTimeLoading,
    error: totalTimeError,
    refetch,
  } = useQuery(TOTAL_TIME_QUERY, {
    variables: {
      // userId: parseFloat(userId),
      userId: !isNaN(parseFloat(userId)) ? parseFloat(userId) : 0,
      projectId: selectedProject,
    },
    skip: !userId || !selectedProject,
    context: { credentials: "include" },
  });

  const [createTimeEntryMutation] = useMutation<
    { createTime: TimeEntry },
    CreateTimeMutationVariables
  >(CREATE_TIME_MUTATION);
  const [updateTimeEntryMutation] = useMutation<{ updateTime: TimeEntry }>(
    UPDATE_TIME_MUTATION
  );

  // return {
  //   ratesData,
  //   totalTimeData,
  //   totalTimeLoading,
  //   totalTimeError,
  //   refetch,
  //   createTimeEntry: (data: {
  //     startTime: string;
  //     projectId: string;
  //     userId: number;
  //     rateId: number;
  //     totalElapsedTime: number;
  //   }): Promise<{ data: { createTime: TimeEntry } }> =>
  //     createTimeEntryMutation({
  //       variables: {
  //         timeInputCreate: {
  //           startTime: data.startTime,
  //           projectId: data.projectId,
  //           userId: data.userId,
  //           rateId: data.rateId,
  //           totalElapsedTime: data.totalElapsedTime,
  //           // No additional fields that might trigger ValidationPipe
  //         },
  //       },
  //     }) as Promise<{
  //       data: { createTime: TimeEntry };
  //     }>,
  //   updateTime: (options: {
  //     timeInputUpdate: {
  //       id: number;
  //       endTime: string;
  //       totalElapsedTime: number;
  //     };
  //   }): Promise<{ data: { updateTime: TimeEntry } }> =>
  //     updateTimeEntryMutation({
  //       variables: {
  //         timeInputUpdate: options.timeInputUpdate,
  //       },
  //     }) as Promise<{
  //       data: { updateTime: TimeEntry };
  //     }>,
  // };
  return {
    ratesData,
    totalTimeData,
    totalTimeLoading,
    totalTimeError,
    refetch,
    createTimeEntry: (
      timeData: CreateTimeData
    ): Promise<{ data: { createTime: TimeEntry } }> =>
      createTimeEntryMutation({
        variables: {
          timeInputCreate: timeData, // <--- Correctly wrap the data
        },
        context: { credentials: "include" }, // Ensure cookies are sent
      }) as Promise<{ data: { createTime: TimeEntry } }>, // Type assertion might still be needed depending on codegen

    updateTime: (options: {
      timeInputUpdate: {
        id: number;
        endTime: string;
        totalElapsedTime: number;
      };
    }): Promise<{ data: { updateTime: TimeEntry } }> =>
      updateTimeEntryMutation({
        variables: options, // updateTime variables are already correctly structured
        context: { credentials: "include" },
      }) as Promise<{ data: { updateTime: TimeEntry } }>,
  };
};

// ====== FILE: src\app\hooks\useTimer.ts ======

import { useState, useEffect, useRef, useCallback, useMemo } from "react";
import { format } from "date-fns";
import type { TimerState } from "../types";
import { useTimerStore } from "@/app/lib/timerStore";

export const useTimer = (): TimerState & {
  initialStartTime: Date | null;
  pauseTimes: Date[];
  resumeTimes: Date[];
  calculateTotalActiveTime: () => number;
} => {
  // --- Get state and actions from the Zustand store ---
  const { isRunning, initialStartTimeISO, pauseTimesISO, resumeTimesISO } =
    useTimerStore();

  const {
    setTimerRunning,
    setInitialStartTime: setInitialStartTimeInStore,
    addPauseTime: addPauseTimeToStore,
    addResumeTime: addResumeTimeToStore,
    resetTimerState: resetTimerStateInStore,
  } = useTimerStore();

  // --- Local state for display only ---
  const [displayTime, setDisplayTime] = useState<string>("00:00:00");
  const timerRef = useRef<number | null>(null);

  // --- Derive Date objects from ISO strings using useMemo ---
  const initialStartTime = useMemo(
    () => (initialStartTimeISO ? new Date(initialStartTimeISO) : null),
    [initialStartTimeISO]
  );

  const pauseTimes = useMemo(
    () => pauseTimesISO.map((iso) => new Date(iso)),
    [pauseTimesISO]
  );

  const resumeTimes = useMemo(
    () => resumeTimesISO.map((iso) => new Date(iso)),
    [resumeTimesISO]
  );

  // --- Calculation Logic (Timestamp-based) ---
  const calculateTotalActiveTime = useCallback((): number => {
    const now = new Date();
    // --- Logging Start ---
    console.log(
      `\n--- Calculating Time (${isRunning ? "Running" : "Paused"}) ---`
    );
    console.log(`Now: ${now.toISOString()}`);
    console.log(`Initial Start: ${initialStartTime?.toISOString() ?? "null"}`);
    console.log(
      `Pause Times: [${pauseTimes.map((d) => d.toISOString()).join(", ")}]`
    );
    console.log(
      `Resume Times: [${resumeTimes.map((d) => d.toISOString()).join(", ")}]`
    );
    // --- Logging End ---
    if (!initialStartTime) {
      console.log(`Calc Result: No initial start time, returning 0ms`);
      return 0;
    }

    let totalMs = 0;
    let segmentStart = initialStartTime;

    for (let i = 0; i < pauseTimes.length; i++) {
      const pauseTime = pauseTimes[i];
      if (pauseTime.getTime() < segmentStart.getTime()) {
        console.warn(
          `Calc Warning: Pause time ${i} (${pauseTime.toISOString()}) is before segment start (${segmentStart.toISOString()}). Skipping segment calculation.`
        );
        if (i < resumeTimes.length) {
          const resumeTime = resumeTimes[i];
          if (resumeTime.getTime() >= pauseTime.getTime()) {
            segmentStart = resumeTime;
            console.log(
              `Calc Recovery: Advanced segmentStart to resume time ${i}: ${segmentStart.toISOString()}`
            );
          } else {
            console.error(
              `Calc Error: Resume time ${i} (${resumeTime.toISOString()}) is before pause time ${i} (${pauseTime.toISOString()}). State invalid.`
            );
            return Math.max(totalMs, 0);
          }
        } else {
          console.error(
            `Calc Error: Pause time ${i} (${pauseTime.toISOString()}) before segment start (${segmentStart.toISOString()}) with no corresponding resume. State invalid.`
          );
          return Math.max(totalMs, 0);
        }
        continue;
      }

      // Calculate duration for this valid segment
      const segmentDuration = pauseTime.getTime() - segmentStart.getTime();
      totalMs += segmentDuration;
      console.log(
        `Calc Segment ${i}: Start=${segmentStart.toISOString()}, Pause=${pauseTime.toISOString()}, Duration=${segmentDuration}ms, AccTotal=${totalMs}ms`
      );

      // Check if there's a corresponding resume time to start the next segment
      if (i < resumeTimes.length) {
        const resumeTime = resumeTimes[i];
        // Basic sanity check: Resume should happen after Pause
        if (resumeTime.getTime() < pauseTime.getTime()) {
          console.warn(
            `Calc Warning: Resume time ${i} (${resumeTime.toISOString()}) is before pause time ${i} (${pauseTime.toISOString()}). Calculation stops here as if still paused.`
          );
          // Treat as if still paused
          console.log(
            `Calc Result: Returning ${totalMs}ms (invalid resume time ${i})`
          );
          return Math.max(totalMs, 0);
        }
        // Set the start for the next potential segment
        segmentStart = resumeTime;
        console.log(
          `Calc: Next segment starts at resume time ${i}: ${segmentStart.toISOString()}`
        );
      } else {
        // This was the last pause, and we haven't resumed. Timer is currently paused.
        console.log(
          `Calc Result: Returning ${totalMs}ms (currently paused after pause ${i})`
        );
        return Math.max(totalMs, 0);
      }
    }

    if (isRunning) {
      if (now.getTime() >= segmentStart.getTime()) {
        const finalSegmentDuration = now.getTime() - segmentStart.getTime();
        totalMs += finalSegmentDuration;
        console.log(
          `Calc: Added final running segment duration: ${finalSegmentDuration}ms (from ${segmentStart.toISOString()} to ${now.toISOString()})`
        );
      } else {
        console.warn(
          `Calc Warning: 'Now' (${now.toISOString()}) is before last segment start (${segmentStart.toISOString()}). Final segment duration is 0. Check system clock or state logic.`
        );
      }
    } else {
      console.log(
        `Calc: Loop finished, timer is not running. Total calculated in loop: ${totalMs}ms`
      );
    }

    console.log(`Calc Final Result: ${totalMs}ms`);
    console.log(`-------------------------------------`);
    return Math.max(totalMs, 0);
  }, [initialStartTime, pauseTimes, resumeTimes, isRunning]);

  // --- Update Display Logic ---
  const updateDisplay = useCallback(() => {
    const elapsedMs = calculateTotalActiveTime();
    const elapsedSeconds = Math.floor(elapsedMs / 1000);
    const formattedTime = format(
      new Date(0, 0, 0, 0, 0, elapsedSeconds),
      "HH:mm:ss"
    );
    setDisplayTime(formattedTime);
  }, [calculateTotalActiveTime]);

  // --- Effect for Initial Display pn Mount/Rehydration ---
  useEffect(() => {
    console.log("useTimer Mount Effect: Setting initial display time.");
    // Caslculate the time based on the state as it was loaded
    const initialElapsedMs = calculateTotalActiveTime();
    const initialElapsedSeconds = Math.floor(initialElapsedMs / 1000);
    const initialFormatedTime = format(
      new Date(0, 0, 0, 0, 0, initialElapsedSeconds),
      "HH:mm:ss"
    );
    setDisplayTime(initialFormatedTime);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  // --- Effect for Interval (Reads `isRunning` from store) ---
  useEffect(() => {
    if (isRunning) {
      console.log(
        "useTimer Effect: isRunning is true, starting/checking interval."
      );
      updateDisplay();
      // Ensure interval isn't already running before setting a new one
      if (timerRef.current === null) {
        timerRef.current = window.setInterval(updateDisplay, 1000);
        console.log(
          "useTimer Effect: Interval started with ID:",
          timerRef.current
        );
      }
    } else if (!isRunning && timerRef.current !== null) {
      console.log(
        "useTimer Effect: isRunning is false, clearing interval ID:",
        timerRef.current
      );
      clearInterval(timerRef.current);
      timerRef.current = null;
    }

    // Cleanup interval on unmount or if isRunning becomes false
    return () => {
      if (timerRef.current !== null) {
        console.log(
          "useTimer Effect: Cleanup clearing interval ID:",
          timerRef.current
        );
        clearInterval(timerRef.current);
        timerRef.current = null; // Ensure ref is cleared on cleanup
      }
    };
  }, [isRunning, updateDisplay]); // Depend on isRunning from store and the memoized updateDisplay

  // --- Control Functions (Dispatch actions to the store) ---
  const start = () => {
    const now = new Date();
    // Check Zustand state directly for most up-to-date values before dispatching
    const {
      isRunning: currentlyRunning,
      initialStartTimeISO: currentInitialISO,
      pauseTimesISO: currentPausesISO,
      resumeTimesISO: currentResumesISO,
    } = useTimerStore.getState();

    if (!currentInitialISO) {
      console.log("useTimer start: Setting initial time in store.");
      setInitialStartTimeInStore(now); // Update Store
    } else if (!currentlyRunning) {
      // ***MODIFIED CONDITION***: Only add resume time if we were actually paused
      // (i.e., if the number of pauses is greater than the number of resumes)
      if (currentPausesISO.length > currentResumesISO.length) {
        console.log("useTimer start: Adding RESUME time to store.");
        addResumeTimeToStore(now); // Update Store
      } else {
        console.log(
          "useTimer start: Starting timer (not resuming from a pause)."
        );
      }
    } else {
      console.log(
        "useTimer start: Called while already running. Doing nothing."
      );
      return;
    }
    console.log("useTimer start: Setting isRunning=true in store.");
    setTimerRunning(true); // Update Store
  };

  const pause = () => {
    if (isRunning) {
      // Check store value via hook selector
      console.log(
        "useTimer pause: Adding pause time and setting isRunning=false in store."
      );
      addPauseTimeToStore(new Date());
      setTimerRunning(false);
    } else {
      console.log("useTimer pause: Called when not running, doing nothing.");
    }
  };

  const reset = () => {
    console.log("useTimer reset: Calling resetTimerStateInStore.");
    resetTimerStateInStore();
    setDisplayTime("00:00:00");
  };

  const handleManualSetStartTime = (date: Date | null) => {
    console.log("useTimer handleManualSetStartTime:", date?.toISOString());
    const currentlyRunning = useTimerStore.getState().isRunning;
    if (currentlyRunning) {
      // Need to pause first *before* resetting state
      console.log("Pausing before manual time set...");
      addPauseTimeToStore(new Date());
      setTimerRunning(false);
    }
    // Now reset the rest of the state and set the new start time
    console.log("Resetting state and setting new start time in store...");
    resetTimerStateInStore();
    setInitialStartTimeInStore(date);

    setDisplayTime("00:00:00");
  };

  return {
    isRunning, // From store
    startTime: initialStartTime, // Derived Date object
    displayTime, // Local display state
    start, // Dispatcher function
    pause, // Dispatcher function
    reset, // Dispatcher function
    setStartTime: handleManualSetStartTime, // Dispatcher function
    // Provide derived Date objects
    initialStartTime: initialStartTime,
    pauseTimes: pauseTimes,
    resumeTimes: resumeTimes,
    calculateTotalActiveTime, // The calculation function
  };
};

// ====== FILE: src\app\issuesPage\page.tsx ======

"use client";

import React, { useMemo, useState, useEffect, useRef } from "react";
import { gql, useQuery } from "@apollo/client";
import NavigationBar from "../components/NavigationBar";
import client from "@/app/lib/apolloClient";
import { io, Socket } from "socket.io-client";

type Label = {
  id: string;
  name: string;
  color: string;
  parentId: string;
};

type Issue = {
  id: string;
  createdAt: string;
  updatedAt: string;
  title: string;
  dueDate: string;
  projectId: string;
  priorityLabel: string;
  identifier: string;
  assigneeName: string;
  projectName: string;
  state: string;
  teamKey: string;
  teamName: string;
  labels: Label[];
};

type GroupedIssues = {
  [key: string]: Issue[];
};

const GET_ISSUES = gql`
  query GetIssues {
    issues {
      id
      createdAt
      updatedAt
      title
      dueDate
      projectId
      priorityLabel
      identifier
      assigneeName
      projectName
      state
      teamKey
      teamName
      labels {
        id
        name
        color
        parentId
      }
    }
  }
`;

const IssuesComponent: React.FC = () => {
  const { loading, error, data, refetch } = useQuery<{ issues: Issue[] }>(
    GET_ISSUES,
    { client }
  );

  const [selectedAssignee, setSelectedAssignee] = useState<string | null>(null);
  const [selectedTeam, setSelectedTeam] = useState<string | null>(null);
  const [socketConnected, setSocketConnected] = useState(false);
  const [groupedIssues, setGroupedIssues] = useState<GroupedIssues>({});
  const socket = useRef<Socket | null>(null);

  const handleSelectAssignee = (assignee: string) => {
    setSelectedAssignee(assignee);
  };

  const handleSelectTeam = (team: string) => {
    setSelectedTeam(team);
  };

  const handleClearFilters = () => {
    setSelectedTeam(null);
    setSelectedAssignee(null);
  };

  const uniqueTeams = useMemo(() => {
    const teams = new Set<string>();
    data?.issues.forEach((issue) => teams.add(issue.teamName));
    return Array.from(teams);
  }, [data?.issues]);

  const uniqueAssignees = useMemo(() => {
    const assignees = new Set<string>();
    data?.issues.forEach((issue) => assignees.add(issue.assigneeName));
    return Array.from(assignees);
  }, [data?.issues]);

  const filteredIssues = useMemo(() => {
    return (
      data?.issues.filter((issue) => {
        return (
          (!selectedTeam || issue.teamName === selectedTeam) &&
          (!selectedAssignee || issue.assigneeName === selectedAssignee)
        );
      }) || []
    );
  }, [data?.issues, selectedTeam, selectedAssignee]);

  useEffect(() => {
    socket.current = io(
      process.env.NEXT_PUBLIC_BACKEND_WEBSOCKET_URL || "http://localhost:8080",
      {
        transports: ["websocket"], // Force WebSocket transport instead of polling
        path: "/socket.io",
        reconnectionAttempts: 5,
        reconnectionDelay: 1000,
        timeout: 20000,
      }
    );

    const currentSocket = socket.current;

    console.log(
      "Attempting to connect to:",
      process.env.NEXT_PUBLIC_BACKEND_WEBSOCKET_URL || "http://localhost:8080"
    );
    socket.current.on("error", (error: Error) => {
      console.error("Socket error:", error);
    });

    currentSocket?.on("connect", () => {
      console.log("WebSocket connected successfully");
      setSocketConnected(true);
    });

    currentSocket?.on("disconnect", (reason: string) => {
      console.log("WebSocket disconnected:", reason);
      setSocketConnected(false);
    });

    currentSocket?.on("issueUpdate", (updatedIssue: Issue) => {
      console.log("Received issue update via WebSocket:", updatedIssue);
      refetch();
    });

    currentSocket?.on("connect_error", (err: Error) => {
      console.error("WebSocket connection error:", err);
    });
    currentSocket?.on("disconnect", (reason: string) => {
      console.log("WebSocket disconnected:", reason);
    });

    return () => {
      if (currentSocket) {
        console.log("Cleaning up WebSocket connection");
        currentSocket.disconnect();
      }
    };
  }, [refetch]);

  useEffect(() => {
    if (filteredIssues) {
      const groups: GroupedIssues = {};
      filteredIssues.forEach((issue) => {
        if (!groups[issue.state]) {
          groups[issue.state] = [];
        }
        groups[issue.state].push(issue);
      });
      setGroupedIssues(groups);
    }
  }, [filteredIssues]);

  if (loading) return <p>Loading issues...</p>;
  if (error) {
    console.error("Error loading issues:", error);
    return <p>Error loading issues: {error.message}</p>;
  }

  const handleRefresh = () => {
    refetch();
  };

  return (
    <>
      <NavigationBar />
      <div className="container mx-auto p-4 font-roboto-condensed">
        <div className="flex">
          <div>
            <div className="flex flex-wrap mb-1">
              {uniqueTeams.map((team) => (
                <button
                  key={team}
                  onClick={() => handleSelectTeam(team)}
                  className={`p-1 m-1 uppercase ${
                    selectedTeam === team ? "bg-green-500" : "bg-black"
                  } text-white rounded hover:bg-gray-800`}
                  style={{ fontSize: "12px" }}
                >
                  {team}
                </button>
              ))}
            </div>
            <div className="flex flex-wrap mb-1">
              {uniqueAssignees.map((assignee) => (
                <button
                  key={assignee}
                  onClick={() => handleSelectAssignee(assignee)}
                  className={`p-1 m-1 uppercase ${
                    selectedAssignee === assignee ? "bg-green-500" : "bg-black"
                  } text-white rounded hover:bg-gray-800`}
                  style={{ fontSize: "12px" }}
                >
                  {assignee}
                </button>
              ))}
            </div>
            <button
              onClick={handleClearFilters}
              className="p-1 m-1 bg-gray-300 text-black rounded hover:bg-gray-400"
              style={{ fontSize: "12px" }}
            >
              Clear Filters
            </button>
          </div>
          <div style={{ position: "fixed", bottom: "20px", right: "20px" }}>
            <button
              onClick={handleRefresh}
              className="p-2 bg-blue-500 text-white rounded-full hover:bg-blue-600"
              style={{ width: "40px", height: "40px" }}
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                x="0px"
                y="0px"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path d="M16 15L24 15 20 20zM8 9L0 9 4 4z"></path>
                <path d="M21 6c0-1.654-1.346-3-3-3H7.161l1.6 2H18c.551 0 1 .448 1 1v10h2V6zM3 18c0 1.654 1.346 3 3 3h10.839l-1.6-2H6c-.551 0-1-.448-1-1V8H3V18z"></path>
              </svg>
            </button>
          </div>
          <div className="fixed bottom-20 right-20 flex items-center">
            <div
              className={`w-3 h-3 rounded-full mr-2 ${
                socketConnected ? "bg-green-500" : "bg-red-500"
              }`}
            ></div>
            <span className="text-sm">
              {socketConnected ? "Connected" : "Disconnected"}
            </span>
          </div>
        </div>
        {Object.keys(groupedIssues).length > 0 ? (
          Object.entries(groupedIssues)
            .filter(([, issues]) => {
              if (selectedTeam) {
                return issues.some((issue) => issue.teamName === selectedTeam);
              }
              return true;
            })
            .map(([stateName, issues]) => (
              <div key={stateName}>
                <h2 className="text-2xl text-white font-bold mb-4 bg-black p-2">
                  {stateName}
                </h2>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                  {issues.map((issue) => (
                    <div
                      key={issue.id}
                      className="border border-gray-200 rounded p-4 shadow-md "
                    >
                      <h3 className="text-xl font-semibold">{issue.title}</h3>
                      <p className="text-sm text-gray-800 bg-slate-200">
                        Project: {issue.projectName}
                      </p>
                      <div className="flex flex-wrap mt-2">
                        {issue.labels.map((label) => (
                          <span
                            key={label.id}
                            style={{ backgroundColor: label.color }}
                            className="text-white text-xs font-semibold mr-2 mb-2 px-2 py-1 rounded"
                          >
                            {label.name}
                          </span>
                        ))}
                      </div>
                      <div className="mt-2 text-sm text-gray-500">
                        <p className="border-b border-gray-200">
                          Priority: {issue.priorityLabel}
                        </p>
                        <p className="border-b border-gray-200">
                          State: {issue.state}
                        </p>
                        <p className="border-b border-gray-200">
                          Team Key: {issue.teamKey}
                        </p>
                        <p className="border-b border-gray-200">
                          Team: {issue.teamName}
                        </p>
                        <p className="border-b border-gray-200">
                          Assignee: {issue.assigneeName}
                        </p>
                        <p className="border-b border-gray-200">
                          Identifier: {issue.identifier}
                        </p>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            ))
        ) : (
          <div>No issues found.</div>
        )}
      </div>
    </>
  );
};

export default IssuesComponent;

// ====== FILE: src\app\lib\apolloClient.ts ======

import {
  ApolloClient,
  InMemoryCache,
  createHttpLink,
  from,
  Observable,
} from "@apollo/client";
import { setContext } from "@apollo/client/link/context";
import { onError } from "@apollo/client/link/error";
import { useAuthStore, getAccessToken } from "./authStore"; // Import store and getter
import gql from "graphql-tag";

// Define the refresh token mutation structure (matching backend resolver)
const REFRESH_TOKEN_MUTATION = gql`
  mutation RefreshToken {
    refreshToken {
      access_token
    }
  }
`;

// --- Auth Link: Adds Access Token Header ---
const authLink = setContext((operation, { headers }) => {
  // Exclude Authorization header for refreshToken mutation itself
  if (operation.operationName === "RefreshToken") {
    return { headers };
  }
  const token = getAccessToken();
  const authHeaders = token ? { Authorization: `Bearer ${token}` } : {};
  return {
    headers: {
      ...headers,
      ...authHeaders,
      "content-type": "application/json",
    },
  };
});

// --- Error Link: Handles Token Expiry and Refresh ---
let isRefreshing = false;
let pendingRequests: ((newAccessToken: string) => void)[] = [];

const resolvePendingRequests = (newAccessToken: string) => {
  pendingRequests.map((callback) => callback(newAccessToken));
  pendingRequests = [];
};

const errorLink = onError(
  ({ graphQLErrors, networkError, operation, forward }) => {
    if (graphQLErrors) {
      console.log("ErrorLink: Detected graphQLErrors:", graphQLErrors);
      for (const err of graphQLErrors) {
        console.log("GraphQL Error received:", JSON.stringify(err, null, 2));
        const extensions = err.extensions || {};
        interface OriginalError {
          statusCode?: number;
          message?: string;
        }
        const originalError = extensions.originalError as OriginalError; // Cast with specific type

        // Check for specific unauthenticated error scenarios
        const isAuthError =
          extensions?.code === "UNAUTHORIZED" || // Custom code from backend guard
          originalError?.statusCode === 401 ||
          err.message.toLowerCase().includes("unauthorized") ||
          err.message.toLowerCase().includes("access denied") ||
          err.message.toLowerCase().includes("invalid token") ||
          err.message.toLowerCase().includes("expired token");

        // Don't refresh if the failed operation was RefreshToken itself!
        if (isAuthError && operation.operationName !== "RefreshToken") {
          console.log(
            `Auth error on operation '${operation.operationName}'. Initiating refresh.`
          );

          if (!isRefreshing) {
            isRefreshing = true;
            console.log("Starting token refresh via mutation...");

            // Use the client instance directly to mutate
            client
              .mutate<{ refreshToken: { access_token: string } }>({
                mutation: REFRESH_TOKEN_MUTATION,
                // No variables needed as refresh token is in cookie
                context: {
                  credentials: "include", // Crucial: ensures cookie is sent
                },
              })
              .then(({ data }) => {
                const newAccessToken = data?.refreshToken.access_token;
                if (!newAccessToken) {
                  console.error(
                    "Token refresh succeeded but no new access token received."
                  );
                  throw new Error("New access token not received."); // Trigger catch block
                }
                console.log(
                  "Token refresh successful. New access token obtained."
                );
                useAuthStore.getState().setAccessToken(newAccessToken); // Update store
                resolvePendingRequests(newAccessToken); // Retry queued requests
              })
              .catch((refreshError) => {
                console.error("Token refresh mutation failed:", refreshError);
                // Clear frontend state and redirect to login
                useAuthStore.getState().logout(); // Clear store
                pendingRequests = []; // Clear queue
                // No need to call backend logout here, refresh already failed
                if (window.location.pathname !== "/login") {
                  window.location.href = "/login"; // Force redirect
                }
              })
              .finally(() => {
                isRefreshing = false;
                console.log("Token refresh process finished.");
              });
          }

          // Return Observable to queue the original request
          return new Observable((observer) => {
            pendingRequests.push((newAccessToken) => {
              console.log(
                `Retrying operation '${operation.operationName}' with new token.`
              );
              operation.setContext(({ headers = {} }) => ({
                headers: {
                  ...headers,
                  Authorization: `Bearer ${newAccessToken}`,
                },
              }));
              forward(operation).subscribe(observer); // Resubscribe with updated context
            });
          });
        }
        // Handle other errors like Forbidden
        if (
          extensions?.code === "FORBIDDEN" ||
          originalError?.statusCode === 403
        ) {
          useAuthStore.getState().setForbidden(true);
        }
      }
    }

    // Handle network errors (optional, but good practice)
    if (networkError) {
      console.error(`[Network error]: ${networkError.message}`, networkError);
      // You could add specific handling for 401 network errors too if they occur
    }
  }
);

// --- HTTP Link ---
const httpLink = createHttpLink({
  uri: `${process.env.NEXT_PUBLIC_BACKEND_URL}/graphql`, // Your GraphQL endpoint
  fetchOptions: {
    method: "POST",
  },
  credentials: "include", // IMPORTANT: Send cookies (like refresh_token) with ALL requests
});

// --- Apollo Client Instance ---
const client = new ApolloClient({
  link: from([
    errorLink, // Handles errors and refresh logic
    authLink, // Adds access token header
    httpLink, // Sends the request
  ]),
  cache: new InMemoryCache(),
  defaultOptions: {
    watchQuery: { fetchPolicy: "cache-and-network" }, // Good default
    query: { fetchPolicy: "network-only", errorPolicy: "all" }, // Ensure fresh data, handle errors
    mutate: { errorPolicy: "all" },
  },
});

// --- Export client and potentially the backend logout function ---
export default client;

// Updated logout function (if needed separately, often called from UI)
export const clientLogout = async () => {
  try {
    // Call backend logout mutation (sends access token via authLink)
    await client.mutate({
      mutation: gql`
        mutation Logout {
          logout {
            success
          }
        }
      `,
      context: { credentials: "include" }, // Ensure cookies cleared even if access token expired
    });
    console.log("Backend logout mutation successful.");
  } catch (error) {
    console.error("Error calling backend logout mutation:", error);
    // Proceed with frontend logout regardless
  } finally {
    // ALWAYS clear frontend state
    useAuthStore.getState().logout();
    await client.resetStore(); // Clear Apollo cache
    console.log("Frontend state cleared.");

    // Redirect
    if (window.location.pathname !== "/login") {
      window.location.href = "/login";
    }
  }
};

// ====== FILE: src\app\lib\authStore.ts ======

import { create } from "zustand";
import { persist } from "zustand/middleware";

interface User {
  id: number;
  email: string;
  role: string;
}

interface AuthState {
  user: User | null;
  accessToken: string | null;
  isForbidden: boolean;
  isAuthenticated: boolean;
  setAuth: (token: string | null, user: User | null) => void;
  setUser: (user: User | null) => void;
  setAccessToken: (token: string | null) => void;
  setForbidden: (isForbidden: boolean) => void;
  logout: () => void;
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set) => ({
      // Initial state
      user: null,
      accessToken: null,
      isForbidden: false,
      isAuthenticated: false,

      // Actions
      setAuth: (token, user) =>
        set({
          accessToken: token,
          user: user,
          isAuthenticated: !!token,
          isForbidden: false,
        }),
      setUser: (user) => set({ user }),
      setAccessToken: (token) =>
        set({
          accessToken: token,
          isAuthenticated: !!token,
        }),
      setForbidden: (isForbidden) => set({ isForbidden }),
      logout: () => {
        console.log("AuthStore: Logging out - clearing state.");
        set({
          user: null,
          accessToken: null,
          isAuthenticated: false,
          isForbidden: false,
        });
      },
    }),
    {
      name: "auth-storage",
      // IMPORTANT: Only persist user info, NOT the access token
      partialize: (state) => ({
        user: state.user,
        // Do NOT persist accessToken or isAuthenticated - derive on load/refresh
      }),

      onRehydrateStorage: () => {
        console.log("AuthStore: Rehydrating user from storage.");

        return (_state, error) => {
          if (error) console.error("AuthStore: Error rehydrating:", error);
        };
      },
    }
  )
);

// Helper function to get token without subscribing (for Apollo Link)
export const getAccessToken = () => useAuthStore.getState().accessToken;

// ====== FILE: src\app\lib\store.ts ======

"use client";

import { create } from "zustand";
import type { Project } from "@/app/hooks/useTimeKeeperData";
import type { Rate } from "@/app/types";

interface StoreUser {
  id: string;
  email: string;
  teams?: { name: string; projects: Project[] }[];
}

type Store = {
  users: StoreUser[];
  projects: Project[];
  rates: Rate[];
  selectedUser: string;
  selectedProject: string;
  selectedRate: string;
  setUsers: (users: StoreUser[]) => void;
  setProjects: (projects: Project[]) => void;
  setRates: (rates: Rate[]) => void;
  setSelectedUser: (selectedUser: string) => void;
  setSelectedProject: (selectedProject: string) => void;
  setSelectedRate: (selectedRate: string) => void;

  teamId: string | null;
  setTeamId: (teamId: string | null) => void;
};

const useStore = create<Store>((set) => ({
  users: [],
  projects: [],
  rates: [],
  selectedUser: "",
  selectedProject: "",
  selectedRate: "",
  setUsers: (users) => set({ users }),
  setProjects: (projects) => set({ projects }),
  setRates: (rates) => set({ rates }),
  setSelectedUser: (selectedUser) => set({ selectedUser }),
  setSelectedProject: (selectedProject) => set({ selectedProject }),
  setSelectedRate: (selectedRate) => set({ selectedRate }),

  teamId: null,
  setTeamId: (teamId) => set({ teamId }),
}));

export default useStore;

// ====== FILE: src\app\lib\timerStore.ts ======

// src/app/lib/timerStore.ts
import { create } from "zustand";
import { persist, createJSONStorage } from "zustand/middleware";

interface TimerPersistedState {
  isRunning: boolean;
  initialStartTimeISO: string | null;
  pauseTimesISO: string[];
  resumeTimesISO: string[];
  currentEntryId: number | null;
  projectIdForTimer: string | null;
  rateIdForTimer: string | null;
}

interface TimerActions {
  setTimerRunning: (running: boolean) => void;
  setInitialStartTime: (date: Date | null) => void;
  addPauseTime: (date: Date) => void;
  addResumeTime: (date: Date) => void;
  setCurrentEntryId: (id: number | null) => void;
  setProjectAndRate: (projectId: string | null, rateId: string | null) => void;
  resetTimerState: () => void;
}

const initialState: TimerPersistedState = {
  isRunning: false,
  initialStartTimeISO: null,
  pauseTimesISO: [],
  resumeTimesISO: [],
  currentEntryId: null,
  projectIdForTimer: null,
  rateIdForTimer: null,
};

export const useTimerStore = create<TimerPersistedState & TimerActions>()(
  persist(
    (set) => ({
      ...initialState,
      setTimerRunning: (running) => set({ isRunning: running }),
      setInitialStartTime: (date) =>
        set({ initialStartTimeISO: date ? date.toISOString() : null }),
      addPauseTime: (date) =>
        set((state) => ({
          pauseTimesISO: [...state.pauseTimesISO, date.toISOString()],
        })),
      addResumeTime: (date) =>
        set((state) => ({
          resumeTimesISO: [...state.resumeTimesISO, date.toISOString()],
        })),
      setCurrentEntryId: (id) => set({ currentEntryId: id }),
      setProjectAndRate: (projectId, rateId) =>
        set({
          projectIdForTimer: projectId,
          rateIdForTimer: rateId,
        }),
      resetTimerState: () => {
        console.log("Resetting timer state in Zustand store"); // Add log
        set({ ...initialState });
      },
    }),
    {
      name: "timer-storage", // Key for localStorage
      storage: createJSONStorage(() => localStorage),
      onRehydrateStorage: () => {
        // Log when state is rehydrated
        console.log("Zustand timer state rehydrated from localStorage");
        return (state, error) => {
          if (error) {
            console.error("Error rehydrating timer state:", error);
          }
        };
      },
    }
  )
);

// ====== FILE: src\app\lib\utils.ts ======

import { type ClassValue, clsx } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}

// ====== FILE: src\app\login\page.tsx ======

"use client";

import React, { useState } from "react";
import Link from "next/link";
import { useRouter } from "next/navigation";
import Image from "next/image";
import { useMutation } from "@apollo/client";
import { LOGIN_MUTATION } from "@/app/graphql/authOperations";
import { useAuthStore } from "@/app/lib/authStore";
import client from "@/app/lib/apolloClient";

interface LoginData {
  login: {
    access_token: string;
    user: {
      id: number;
      email: string;
      role: string;
    };
  };
}

const Login: React.FC = () => {
  const [email, setEmail] = useState<string>("");
  const [password, setPassword] = useState<string>("");
  const [errorMessage, setErrorMessage] = useState<string | null>(null);
  const router = useRouter();
  // Get the combined setAuth action from the store
  const setAuth = useAuthStore((state) => state.setAuth);

  const [login, { loading }] = useMutation<LoginData>(LOGIN_MUTATION, {
    client: client, // Use the configured Apollo client
    onCompleted: (data) => {
      // Check if login data, token, AND user are present
      if (data?.login?.access_token && data?.login?.user) {
        const { access_token, user } = data.login;
        console.log("Login successful. Storing token and user data.");
        setAuth(access_token, user);
        // Redirect after successful state update
        router.push("/timeKeeper");
      } else {
        // Handle cases where backend response is missing expected data
        const errorMsg = "Login failed: Incomplete data received from server.";
        setErrorMessage(errorMsg);
        console.error(errorMsg, data);
      }
    },
    onError: (error) => {
      console.error("Login mutation error:", error);

      if (
        error.message.includes("Invalid email or password") ||
        error.message.includes("Unauthorized")
      ) {
        setErrorMessage("Invalid email or password.");
      } else {
        setErrorMessage(
          error.message || "An unexpected error occurred during login."
        );
      }
    },
  });

  const handleLogin = (e: React.FormEvent<HTMLFormElement>) => {
    e.preventDefault();
    setErrorMessage(null);
    login({
      variables: {
        input: { email, password },
      },
    });
  };

  return (
    <div className="flex flex-col items-center justify-center h-screen bg-gray-100">
      <div className="p-8 bg-white rounded shadow-md w-96">
        <p className="text-gray-600 mb-1 text-center">WELCOME BACK</p>
        <h1 className="text-center text-2xl font-bold mb-4">
          Log In To Your Account
        </h1>

        <form onSubmit={handleLogin}>
          <input
            className="mb-2 p-2 w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-400"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            placeholder="Email"
          />

          <input
            className="mb-4 p-2 w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-400"
            type="password"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            placeholder="Password"
          />

          <button
            type="submit"
            disabled={loading}
            className="w-full bg-black text-white p-2 rounded focus:outline-none hover:bg-gray-700 mb-4 disabled:bg-gray-400"
          >
            {loading ? "LOGGING IN..." : "CONTINUE"}
          </button>

          <div className="text-center">
            <p className=" cursor-pointer ">
              New User ?{" "}
              <Link href="/signup" className="text-blue-500">
                SIGN UP HERE
              </Link>
            </p>
          </div>

          {errorMessage && <p className="mt-4 text-red-500">{errorMessage}</p>}
        </form>
        <div className="flex justify-end items-end mt-20">
          <Image
            src="/logo.svg"
            alt="Enablment-tt Logo"
            width={150}
            height={40}
          />
        </div>
      </div>
    </div>
  );
};

export default Login;

// ====== FILE: src\app\signup\page.tsx ======

"use client";
import React, { useState } from "react";
import Link from "next/link";
import { useRouter } from "next/navigation";
import Image from "next/image";
import { useMutation } from "@apollo/client";
import { SIGNUP_MUTATION } from "@/app/graphql/authOperations";
import { useAuthStore } from "@/app/lib/authStore";

interface SignUpData {
  signup: {
    access_token: string;
    user: {
      id: number;
      email: string;
      role: string;
    };
  };
}

interface ValidationErrorOriginalError {
  message?: string | string[];
}

interface GraphQLErrorExtensions {
  code?: string;
  originalError?: ValidationErrorOriginalError;
}

const Signup: React.FC = () => {
  const [email, setEmail] = useState<string>("");
  const [password, setPassword] = useState<string>("");
  const router = useRouter();
  const [errors, setErrors] = useState<{
    email?: string;
    password?: string;
    general?: string;
  }>({});
  const passwordRegex =
    /^(?=.*[A-Z])(?=.*[!@#$%^&*()_+{}\[\]:;<>,.?~\\/-]).{8,}$/;

  const setAuth = useAuthStore((state) => state.setAuth);

  const [signup, { loading }] = useMutation<SignUpData>(SIGNUP_MUTATION, {
    onCompleted: (data) => {
      if (data?.signup?.access_token && data?.signup?.user) {
        console.log("Signup successful. Redirecting to login...");
        setAuth(data.signup.access_token, data.signup.user);
        router.push("/timeKeeper");
      } else {
        console.error("Signup completed but response data is missing.", data);
        setErrors({
          general:
            "Signup process incomplete. Please try logging in or contact support.",
        });
      }
    },
    onError: (error) => {
      console.error("Error during signup:", error);

      // Check for email already exists error
      if (error.message.includes("Email already exists")) {
        setErrors({
          ...errors,
          email: "Email already exists.",
        });
      } else if (
        error.graphQLErrors?.some(
          (e) => e.extensions?.code === "BAD_USER_INPUT"
        )
      ) {
        // Handle potential validation errors from backend ValidationPipe
        const validationError = error.graphQLErrors.find(
          (e) => e.extensions?.code === "BAD_USER_INPUT"
        );
        // const message = (validationError?.extensions?.originalError as any)
        //   ?.message;
        // setErrors({ general: `Signup failed: ${message || "Invalid input."}` });
        const extensions = validationError?.extensions as
          | GraphQLErrorExtensions
          | undefined;
        let extractedMessage: string | undefined = undefined;
        const originalMsg = extensions?.originalError?.message;

        if (Array.isArray(originalMsg)) {
          extractedMessage = originalMsg.join(", ");
        } else if (typeof originalMsg === "string") {
          extractedMessage = originalMsg;
        }

        setErrors({
          general: `Signup failed: ${extractedMessage || "Invalid input."}`,
        });
      } else {
        setErrors({
          ...errors,
          general: error.message || "An error occurred during signup.",
        });
      }
    },
    context: {
      credentials: "include",
    },
  });

  const validateForm = () => {
    let valid = true;
    const newErrors: { email?: string; password?: string } = {};

    // Check if email is valid
    const emailRegex = /\S+@\S+\.\S+/;
    if (!email || !emailRegex.test(email)) {
      newErrors.email = "Please provide a valid email address.";
      valid = false;
    }

    // Check if password is valid
    if (!password || !passwordRegex.test(password)) {
      newErrors.password =
        "Password must be at least 8 characters long, have at least one uppercase letter, and one special character.";
      valid = false;
    }

    setErrors(newErrors);
    return valid;
  };

  const handleSignup = async (event: React.FormEvent<HTMLFormElement>) => {
    event.preventDefault();
    setErrors({});

    if (!validateForm()) {
      return;
    }

    signup({
      variables: {
        input: {
          email,
          password,
        },
      },
      context: {
        credentials: "include",
      },
    });
  };

  return (
    <div className="flex items-center justify-center h-screen bg-gray-100">
      <div className="p-8 bg-white rounded shadow-md w-96">
        <h2 className="text-center text-2xl font-bold mb-4">
          Create an Account
        </h2>
        <form onSubmit={handleSignup}>
          <input
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            placeholder="Email"
            className="mb-2 p-2 w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-400"
          />
          {errors.email && (
            <p className="text-red-500 text-sm">{errors.email}</p>
          )}
          <input
            type="password"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            placeholder="Password"
            className="mb-2 p-2 w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-400"
          />
          {errors.password && (
            <p className="text-red-500 text-sm">{errors.password}</p>
          )}
          <button
            type="submit"
            disabled={loading}
            className="w-full bg-black text-white p-2 rounded focus:outline-none hover:bg-gray-700 mb-4 disabled:bg-gray-400"
          >
            {loading ? "CREATING ACCOUNT..." : "GET STARTED"}
          </button>
          {errors.general && (
            <p className="text-red-500 text-sm mb-4">{errors.general}</p>
          )}
        </form>
        <div className="flex justify-center">
          <span>
            Already have an account?{" "}
            <Link href="/login" className="text-blue-500">
              LOGIN HERE
            </Link>
          </span>
        </div>
        <div className="flex justify-end items-end mt-20">
          <Image
            src="/logo.svg"
            alt="Enablment-tt Logo"
            width={150}
            height={40}
          />
        </div>
      </div>
    </div>
  );
};

export default Signup;

// ====== FILE: src\app\timeKeeper\page.tsx ======

"use client";

import React, { useEffect, useState } from "react";
import { useTimer } from "@/app/hooks/useTimer";
import useStore from "@/app/lib/store";
import { useAuthStore } from "@/app/lib/authStore";
import useCurrentUser from "@/app/hooks/useCurrentUser";
import { useFeedbackState } from "@/app/hooks/useFeedbackState";
import { useTimeKeeperQueries } from "@/app/hooks/useTimekeeperQueries";
import { useTimeKeeperHandlers } from "@/app/hooks/useTimekeeperHandlers";
import useTimeKeeperData from "@/app/hooks/useTimeKeeperData";
import NavigationBar from "@/app/components/NavigationBar";
import FeedbackMessages from "@/app/components/FeedbackMessages";
import TimerDisplay from "@/app/components/TimerDisplay";
import TimerControls from "@/app/components/TimerControls";
import ProjectRateSelectors from "@/app/components/ProjectRateSelectors";

const TimeKeeper: React.FC = () => {
  const { selectedProject, setSelectedProject, selectedRate, setSelectedRate } =
    useStore();
  const timerState = useTimer();
  const { userProjects, currentTeamId } = useTimeKeeperData();
  const feedbackState = useFeedbackState();

  const [currentEntryId, setCurrentEntryId] = useState<number | null>(null);

  useCurrentUser();
  const loggedInUser = useAuthStore((state) => state.user);

  const {
    ratesData,
    totalTimeData,
    totalTimeLoading,
    totalTimeError,
    refetch,
    createTimeEntry,
    updateTime,
  } = useTimeKeeperQueries(
    currentTeamId!,
    selectedProject,
    loggedInUser?.id || ""
  );

  const { handleDateChange, handleSubmit, handleReset } = useTimeKeeperHandlers(
    {
      timerState,
      selectedProject,
      selectedRate,
      userId: loggedInUser?.id || "",
      createTimeEntry,
      updateTime,
      currentEntryId,
      setCurrentEntryId,
      showSuccessMessage: feedbackState.actions.showSuccessMessage,
      setSubmissionError: feedbackState.actions.setSubmissionError,
      showDateAlert: feedbackState.actions.showDateAlert,
      showResetMessage: feedbackState.actions.showResetMessage,
    }
  );

  useEffect(() => {
    if (selectedProject) {
      refetch();
    }
  }, [selectedProject, refetch]);

  return (
    <>
      <NavigationBar />
      <div className="relative max-w-6xl mx-auto p-6 rounded flex flex-col font-roboto-condensed">
        <FeedbackMessages {...feedbackState.state} />
        <TimerDisplay
          {...timerState}
          initialStartTime={timerState.initialStartTime}
          handleDateChange={handleDateChange}
        />
        <TimerControls
          isRunning={timerState.isRunning}
          handleStartStop={
            timerState.isRunning ? timerState.pause : timerState.start
          }
          handleReset={handleReset}
          handleSubmit={handleSubmit}
          disabledStartPause={!selectedProject || !selectedRate}
          disabledReset={!timerState.initialStartTime}
          disabledSubmit={timerState.isRunning || !timerState.initialStartTime}
        />
        <ProjectRateSelectors
          userProjects={userProjects}
          selectedProject={selectedProject}
          setSelectedProject={setSelectedProject}
          rates={ratesData?.rates ?? []}
          selectedRate={selectedRate}
          setSelectedRate={setSelectedRate}
          totalTimeLoading={totalTimeLoading}
          totalTimeError={totalTimeError}
          totalTime={totalTimeData?.getTotalTimeForUserProject ?? 0}
        />
      </div>
    </>
  );
};

export default TimeKeeper;

// ====== FILE: src\app\utils\timeUtils.ts ======

// timeUtils.ts

export const formatDateForDisplay = (date: Date): string => {
  const options: Intl.DateTimeFormatOptions = {
    weekday: "long",
    year: "numeric",
    month: "long",
    day: "numeric",
  };
  return date.toLocaleDateString("en-US", options);
};

export const formatTimeFromISOString = (isoString: string): string => {
  const date = new Date(isoString);
  const hours = date.getHours();
  const minutes = date.getMinutes();
  const seconds = date.getSeconds();

  const formattedTime = `${hours}:${minutes < 10 ? `0${minutes}` : minutes}:${
    seconds < 10 ? `0${seconds}` : seconds
  }`;
  return formattedTime;
};

export const formatElapsedTime = (milliseconds: number): string => {
  let seconds = Math.floor(milliseconds / 1000);
  let minutes = Math.floor(seconds / 60);
  const hours = Math.floor(minutes / 60);

  seconds %= 60;
  minutes %= 60;

  const paddedHours = hours.toString().padStart(2, "0");
  const paddedMinutes = minutes.toString().padStart(2, "0");
  const paddedSeconds = seconds.toString().padStart(2, "0");

  return `${paddedHours}:${paddedMinutes}:${paddedSeconds}`;
};
export function formatTimeFromMilliseconds(ms: number): string {
  const totalSeconds = Math.floor(ms / 1000);
  const seconds = totalSeconds % 60;
  const minutes = Math.floor(totalSeconds / 60) % 60;
  const hours = Math.floor(totalSeconds / 3600);
  return `${hours.toString().padStart(2, "0")}:${minutes
    .toString()
    .padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
}

// ====== FILE: src\app\components\Admin\invoiceSummary.tsx ======

"use client";

import React, { useState, useEffect, useMemo } from "react";
import { useQuery } from "@apollo/client";
import gql from "graphql-tag";
import ProjectSelector from "../ProjectSelector";

// --- Interfaces ---

// Interface for the data coming from the GraphQL query
interface QueryRateDetail {
  rateId: number;
  rateName: string;
  hours: number;
  cost: number;
  ratePerHour: number;
  __typename?: string; // Allow __typename from Apollo
}

// Interface for the invoice data state and query result
interface InvoiceData {
  projectId: string;
  projectName: string;
  totalHours: number;
  totalCost: number;
  rates: QueryRateDetail[]; // Use QueryRateDetail for incoming data
  __typename?: string; // Allow __typename
}

interface Team {
  id: string;
  name: string;
}

// Use a more precise type for projects used in the selector
interface ProjectForSelector {
  id: string;
  name: string;
  teamId: string;
  teamName: string; // This should be guaranteed by projectsWithTeamNames
}

// Type for raw project data from query
interface RawProject {
  id: string;
  name: string;
  teamId: string;
}

// --- GraphQL Queries ---
const GET_PROJECTS = gql`
  query GetRawProjects {
    projects {
      id
      name
      teamId
    }
  }
`;

const GET_ALL_TEAMS = gql`
  query GetAllSimpleTeams {
    getAllSimpleTeams {
      id
      name
    }
  }
`;

const GET_INVOICE_FOR_PROJECT = gql`
  query InvoiceForProject($input: InvoiceInput!) {
    invoiceForProject(input: $input) {
      projectId
      projectName
      totalHours
      totalCost
      rates {
        rateId
        rateName
        hours
        cost
        ratePerHour
      }
    }
  }
`;

// --- Type for Query Results ---
interface GetRawProjectsData {
  projects: RawProject[];
}

interface GetAllTeamsData {
  getAllSimpleTeams: Team[];
}

interface GetInvoiceData {
  invoiceForProject: InvoiceData | null; // Allow null if no data found
}

// --- Component ---
const InvoiceSummary: React.FC = () => {
  // --- State ---
  const [selectedProject, setSelectedProject] = useState<string>("");
  const [startDate, setStartDate] = useState<string>("");
  const [endDate, setEndDate] = useState<string>("");
  const [invoiceData, setInvoiceData] = useState<InvoiceData | null>(null);

  // --- Data Fetching ---
  const { data: projectsData } = useQuery<GetRawProjectsData>(GET_PROJECTS);
  const { data: teamsData } = useQuery<GetAllTeamsData>(GET_ALL_TEAMS);

  const { loading: loadingInvoice, error: errorInvoice } =
    useQuery<GetInvoiceData>(GET_INVOICE_FOR_PROJECT, {
      variables: {
        input: {
          projectId: selectedProject,
          // Ensure dates are valid before converting, pass null if empty/invalid
          startDate: startDate ? new Date(startDate).toISOString() : null,
          endDate: endDate ? new Date(endDate).toISOString() : null,
        },
      },
      // Only run query when all inputs are valid and selected
      skip: !selectedProject || !startDate || !endDate,
      fetchPolicy: "network-only", // Re-fetch when variables change
      notifyOnNetworkStatusChange: true,
      onCompleted: (data) => {
        // Update state when data successfully arrives
        setInvoiceData(data?.invoiceForProject ?? null);
        console.log("Invoice data received:", data?.invoiceForProject);
      },
      onError: (error) => {
        console.error("Error fetching invoice:", error);
        setInvoiceData(null); // Clear data on error
      },
    });

  // --- Memoized Derived Data ---
  const teamIdToNameMap = useMemo(() => {
    if (!teamsData?.getAllSimpleTeams) return {};
    return teamsData.getAllSimpleTeams.reduce(
      (acc: Record<string, string>, team) => {
        acc[team.id] = team.name;
        return acc;
      },
      {}
    );
  }, [teamsData]);

  const projectsWithTeamNames = useMemo<ProjectForSelector[]>(() => {
    // Use specific type
    if (!projectsData?.projects || Object.keys(teamIdToNameMap).length === 0)
      return [];
    return projectsData.projects.map((project) => ({
      ...project,
      // Ensure teamName is always a string for the selector
      teamName: teamIdToNameMap[project.teamId] || "Unknown Team",
    }));
  }, [projectsData, teamIdToNameMap]);

  // Memoize finding the teamId for the selected invoice project
  const projectTeamId = useMemo<string | undefined>(() => {
    if (!invoiceData || !projectsData?.projects) return undefined;
    return projectsData.projects.find(
      (project) => project.id === invoiceData.projectId
    )?.teamId;
  }, [projectsData, invoiceData]);

  // --- Logging Effect (Optional, for debugging) ---
  useEffect(() => {
    console.log("Invoice State Update:", {
      selectedProject,
      startDate,
      endDate,
      invoiceData,
      loadingInvoice,
      errorInvoice,
    });
  }, [
    selectedProject,
    startDate,
    endDate,
    invoiceData,
    loadingInvoice,
    errorInvoice,
  ]);

  // --- Helper Functions ---
  const formatCurrency = (value: number | null | undefined): string => {
    if (value === null || value === undefined) return "-"; // Handle null/undefined
    // Added safety check for non-numbers
    if (isNaN(value)) return "Invalid";

    try {
      return new Intl.NumberFormat("da-DK", {
        // Use Danish locale for DKK
        style: "currency",
        currency: "DKK",
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
      }).format(value);
    } catch (e) {
      console.error("Error formatting currency:", e);
      return String(value); // Fallback
    }
  };

  // --- Render Logic ---
  const renderInvoiceDetails = () => {
    if (loadingInvoice) {
      return <p className="text-gray-400 mt-4">Loading Invoice...</p>;
    }
    if (errorInvoice) {
      return (
        <div className="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mt-4 rounded">
          <p className="font-bold">Error Loading Invoice</p>
          <p>{errorInvoice.message}</p>
        </div>
      );
    }
    if (invoiceData) {
      // Check if invoiceData exists (not null)
      return (
        <div className="mt-4 p-6 bg-white shadow-md rounded-lg">
          <h4 className="text-md font-bold bg-slate-200 p-2 rounded-t-lg">
            {" "}
            {/* Added padding/rounding */}
            Project: {invoiceData.projectName} - Team:{" "}
            {teamIdToNameMap && projectTeamId
              ? teamIdToNameMap[projectTeamId] || "N/A" // Display N/A if not found
              : "..."}
          </h4>
          <div className="p-2 space-y-1">
            {" "}
            {/* Added padding */}
            <p className="border-b border-gray-200 pb-1">
              Total Hours: {invoiceData.totalHours?.toFixed(2) ?? "N/A"}{" "}
              {/* Added nullish coalescing */}
            </p>
            <p className="border-b border-gray-200 pb-1">
              Total Cost: {formatCurrency(invoiceData.totalCost)}
            </p>
            <div className="mt-4">
              <h5 className="font-semibold bg-slate-200 p-1">Rates Applied:</h5>
              {invoiceData.rates && invoiceData.rates.length > 0 ? (
                <ul className="list-disc list-inside pl-4 pt-1">
                  {" "}
                  {/* Added list styling */}
                  {invoiceData.rates.map(
                    (
                      rate: QueryRateDetail // Use QueryRateDetail type
                    ) => (
                      <li
                        className="border-b border-gray-100 py-1 text-sm" // Adjusted styling
                        key={rate.rateId} // Use number rateId
                      >
                        {rate.rateName}: {rate.hours?.toFixed(2) ?? "N/A"} hours
                        at {formatCurrency(rate.cost)} (
                        {formatCurrency(rate.ratePerHour)} / h)
                      </li>
                    )
                  )}
                </ul>
              ) : (
                <p className="text-gray-500 text-sm pt-1">
                  No specific rates applied for this period.
                </p>
              )}
            </div>
          </div>
        </div>
      );
    }
    // If inputs are selected but no data/error/loading state exists
    if (selectedProject && startDate && endDate) {
      return (
        <p className="text-gray-400 mt-4">
          No invoice data found for the selected criteria.
        </p>
      );
    }

    // If inputs are not yet selected
    return (
      <p className="text-gray-500 mt-4">
        Please select a project and date range.
      </p>
    );
  };

  // --- Component Return ---
  return (
    <div className="p-6 bg-black shadow-md rounded-lg">
      <div className="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0 md:space-x-4 mb-4">
        <h3 className="text-lg font-bold text-white">Invoice Summary</h3>
        <div className="flex-grow">
          <ProjectSelector
            projects={projectsWithTeamNames} // Pass memoized list
            selectedProject={selectedProject}
            onProjectChange={setSelectedProject}
          />
        </div>
        <div className="flex-grow flex flex-col md:flex-row gap-2 md:gap-4">
          <input
            type="date"
            value={startDate}
            onChange={(e) => setStartDate(e.target.value)}
            className="w-full p-2 bg-white text-black border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
            aria-label="Start Date"
          />
          <input
            type="date"
            value={endDate}
            onChange={(e) => setEndDate(e.target.value)}
            className="w-full p-2 bg-white text-black border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
            aria-label="End Date"
          />
        </div>
      </div>
      {renderInvoiceDetails()}
    </div>
  );
};

export default InvoiceSummary;

// ====== FILE: src\app\components\Admin\ratesManager.tsx ======

"use client";

import React, { useState } from "react";
import { useQuery, useMutation, gql, ApolloError } from "@apollo/client";

interface Team {
  id: string;
  name: string;
}

interface Rate {
  id: number;
  name: string;
  teamId: string;
  rate: number;
}

// GraphQL Queries and Mutations
const GET_ALL_SIMPLE_TEAMS = gql`
  query GetAllSimpleTeams {
    getAllSimpleTeams {
      id
      name
    }
  }
`;

const CREATE_RATE = gql`
  mutation CreateRate($name: String!, $rate: Int!, $teamId: String!) {
    createRate(rateInputCreate: { name: $name, rate: $rate, teamId: $teamId }) {
      id
      name
      rate
      teamId
    }
  }
`;

const DELETE_RATE = gql`
  mutation DeleteRate($rateId: Int!) {
    deleteRate(rateId: $rateId) {
      id
    }
  }
`;

const GET_RATES = gql`
  query GetRates($teamId: String!) {
    rates(teamId: $teamId) {
      id
      name
      rate
    }
  }
`;

const RatesManager = () => {
  const [selectedTeamId, setSelectedTeamId] = useState("");
  const [rateName, setRateName] = useState("");
  const [rateValue, setRateValue] = useState(0);

  const [error, setError] = useState<ApolloError | null>(null);

  const { loading: teamsLoading, data: teamsData } = useQuery(
    GET_ALL_SIMPLE_TEAMS,
    {
      context: { useLinearApi: false },
      onError: (error) => {
        setError(error);
      },
    }
  );

  const {
    loading: ratesLoading,
    data: ratesData,
    refetch: refetchRates,
  } = useQuery(GET_RATES, {
    variables: { teamId: selectedTeamId },
    skip: !selectedTeamId,
  });
  const [createRate] = useMutation(CREATE_RATE, {
    onCompleted: () => refetchRates(),
  });
  const [deleteRate] = useMutation(DELETE_RATE, {
    onCompleted: () => refetchRates(),
    onError: (error) => {
      console.error("Error deleting rate:", error);
    },
  });

  const handleCreateRate = () => {
    if (selectedTeamId) {
      createRate({
        variables: { name: rateName, rate: rateValue, teamId: selectedTeamId },
      });
      setRateName("");
      setRateValue(0);
    }
  };

  const handleDeleteRate = (rateId: number) => {
    console.log("Attempting to delete rate with ID:", rateId);
    deleteRate({ variables: { rateId } }).catch((error) => {
      setError(error);
    });
  };
  if (error) return <p>Error: {error.message}</p>;
  if (teamsLoading || ratesLoading) return <p>Loading...</p>;
  if (!teamsData || !teamsData.getAllSimpleTeams)
    return <p>No data available.</p>;

  return (
    <div className="p-6 bg-black shadow-md flex flex-row justify-between items-center">
      <h3 className="font-bold text-lg text-white">Manage Rates</h3>

      <div>
        <select
          id="teamSelector"
          className="w-full p-2 mt-1 border border-gray-300 rounded"
          onChange={(e) => setSelectedTeamId(e.target.value)}
          value={selectedTeamId}
        >
          <option value="">Select a Team</option>
          {teamsData.getAllSimpleTeams.map((team: Team) => (
            <option key={team.id} value={team.id}>
              {team.name}
            </option>
          ))}
        </select>
      </div>

      <div>
        <input
          type="text"
          id="rateName"
          className="w-full p-2 mt-1 border border-gray-300 rounded"
          value={rateName}
          onChange={(e) => setRateName(e.target.value)}
          placeholder="Rate Name"
        />
      </div>

      <div>
        <input
          type="number"
          id="rateValue"
          className="w-full p-2 mt-1 border border-gray-300 rounded"
          value={rateValue}
          onChange={(e) => setRateValue(parseInt(e.target.value) || 0)}
          placeholder="Amount"
        />
      </div>

      <div>
        <button
          className="w-full p-2 bg-white text-black rounded hover:bg-blue-600 font-bold"
          onClick={handleCreateRate}
        >
          Create Rate
        </button>
      </div>

      <div>
        {ratesData &&
          ratesData.rates.map((rate: Rate) => (
            <div
              key={rate.id}
              className="flex justify-between items-center p-1 bg-gray-100 border border-gray-200 rounded m-2"
            >
              <span className="font-semibold mr-2">
                {rate.name} - {rate.rate}
              </span>
              <button
                className="p-1 bg-red-500 text-white rounded hover:bg-red-600"
                onClick={() => handleDeleteRate(rate.id)}
              >
                Delete
              </button>
            </div>
          ))}
      </div>
    </div>
  );
};

export default RatesManager;

// ====== FILE: src\app\components\Admin\totalTimeSpent.tsx ======

"use client";

import React, { useState, useEffect } from "react";
import { useQuery } from "@apollo/client";
import gql from "graphql-tag";
import { useAuthStore } from "@/app/lib/authStore";
import useCurrentUser from "@/app/hooks/useCurrentUser";
import { formatTimeFromMilliseconds } from "@/app/utils/timeUtils";

interface Project {
  id: string;
  name: string;
  teamName?: string;
}

interface Team {
  name: string;
  projects: Project[];
}

interface User {
  id: string;
  email: string;
  teams?: Team[];
}

const GET_DROPDOWN_OPTIONS = gql`
  query {
    users {
      id
      email
    }
    projects {
      id
      name
    }
  }
`;

const GET_TOTAL_TIME_SPENT = gql`
  query GetTotalTimeSpent(
    $userId: Float!
    $projectId: String!
    $startDate: String!
    $endDate: String!
  ) {
    getTotalTimeSpent(
      userId: $userId
      projectId: $projectId
      startDate: $startDate
      endDate: $endDate
    )
  }
`;

const GET_USER_PROJECTS = gql`
  query GetUserProjects {
    users {
      id
      teams {
        name
        projects {
          id
          name
        }
      }
    }
  }
`;

const getCurrentDate = () => new Date().toISOString().split("T")[0];

const TotalTimeSpent: React.FC = () => {
  const [totalTime, setTotalTime] = useState(0);
  const [selectedProject, setSelectedProject] = useState<string | null>(null);
  const [startDate, setStartDate] = useState(getCurrentDate());
  const [endDate, setEndDate] = useState(getCurrentDate());

  // Use the auth store instead of reactive variable
  useCurrentUser();
  const loggedInUser = useAuthStore((state) => state.user);
  const [userProjects, setUserProjects] = useState<Project[]>([]);

  const { data: userProjectsData } = useQuery(GET_USER_PROJECTS, {
    skip: !loggedInUser,
  });

  const { error: errorOptions } = useQuery(GET_DROPDOWN_OPTIONS);
  const {
    loading: loadingTime,
    error: errorTime,
    data: timeData,
    refetch,
  } = useQuery(GET_TOTAL_TIME_SPENT, {
    variables: {
      userId: loggedInUser ? parseFloat(loggedInUser.id) : null,
      projectId: selectedProject,
      startDate,
      endDate,
    },
    skip: !loggedInUser || !selectedProject,
  });

  useEffect(() => {
    if (userProjectsData && loggedInUser) {
      const userWithProjects = userProjectsData.users.find(
        (user: User) => user.id === loggedInUser.id
      );
      if (userWithProjects) {
        const projectsWithTeamName = userWithProjects.teams.flatMap(
          (team: Team) =>
            team.projects.map((project: Project) => ({
              ...project,
              teamName: team.name,
            }))
        );
        setUserProjects(projectsWithTeamName);
      }
    }
  }, [userProjectsData, loggedInUser]);

  useEffect(() => {
    if (selectedProject) {
      refetch();
    }
  }, [selectedProject, startDate, endDate, refetch]);

  useEffect(() => {
    if (timeData) {
      setTotalTime(timeData.getTotalTimeSpent);
    }
  }, [timeData]);

  if (loadingTime) return <p>Loading...</p>;
  if (errorOptions || errorTime?.message) {
    const errorMessage = errorOptions
      ? errorOptions.message
      : errorTime?.message;
    return (
      <div className="bg-red-50 border-l-8 border-red-400 p-4 mb-4">
        <div className="flex">
          <div className="flex-shrink-0">
            <svg
              className="h-5 w-5 text-red-400"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 20 20"
              fill="currentColor"
              aria-hidden="true"
            >
              <path
                fillRule="evenodd"
                d="M8.257 3.099c.366-.47.977-.751 1.743-.751s1.377.281 1.743.75l6.857 8.8c.38.487.4 1.128.06 1.625a1.162 1.162 0 01-.86.426H2.25c-.334 0-.65-.14-.86-.426a1.163 1.163 0 01-.06-1.625l6.857-8.8z"
                clipRule="evenodd"
              />
            </svg>
          </div>
          <div className="ml-3">
            <h3 className="text-sm font-medium text-red-800">Error</h3>
            <div className="text-sm text-red-600">
              <p>{errorMessage}</p>
            </div>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="p-6 bg-black shadow-md flex flex-row justify-between items-center">
      <h3 className="text-lg font-bold text-white">
        Get Time Spent on Project
      </h3>
      <div>
        <select
          id="projectSelector"
          value={selectedProject || ""}
          onChange={(e) => setSelectedProject(e.target.value)}
          className="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
        >
          <option value="">Select a Project</option>
          {userProjects.map((project: Project) => (
            <option key={project.id} value={project.id}>
              {project.name} (Team: {project.teamName})
            </option>
          ))}
        </select>
      </div>

      {/* Date Pickers */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <input
          type="date"
          id="startDatePicker"
          value={startDate}
          onChange={(e) => setStartDate(e.target.value)}
          className="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
        />
        <input
          type="date"
          id="endDatePicker"
          value={endDate}
          onChange={(e) => setEndDate(e.target.value)}
          className="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
        />
      </div>

      {/* Total Time Display */}
      <p className="text-lg font-medium text-white">
        Total Time: {formatTimeFromMilliseconds(totalTime)}
      </p>
    </div>
  );
};

export default TotalTimeSpent;

// ====== FILE: src\app\components\Admin\UserRoleSelect.tsx ======

"use client";
import React from "react";

export enum UserRole {
  ADMIN = "ADMIN",
  ENABLER = "ENABLER",
  COLLABORATOR = "COLLABORATOR",
  PENDING = "PENDING",
}

interface UserRoleSelectProps {
  currentRole: UserRole;
  onRoleChange: (newRole: UserRole) => void;
}

const UserRoleSelect: React.FC<UserRoleSelectProps> = ({
  currentRole,
  onRoleChange,
}) => {
  return (
    <select
      value={currentRole}
      onChange={(e) => onRoleChange(e.target.value as UserRole)}
    >
      {Object.values(UserRole).map((role) => (
        <option key={role} value={role}>
          {role}
        </option>
      ))}
    </select>
  );
};

export default UserRoleSelect;

// ====== FILE: src\app\components\Admin\UserRow.tsx ======

"use client";
import React from "react";
import UserRoleSelect, { UserRole } from "./UserRoleSelect";

export interface Team {
  id: string;
  name: string;
}

export interface User {
  id: number;
  email: string;
  role: UserRole;
  teams: Team[];
}

interface UserRowProps {
  user: User;
  teams: Team[];
  onTeamSelect: (userId: number, teamId: string) => void;
  onAddToTeam: (userId: number) => void;
  onRemoveFromTeam: (userId: number, teamId: string) => void;
  onRoleChange: (userId: number, newRole: UserRole) => void;
}

const UserRow: React.FC<UserRowProps> = ({
  user,
  teams,
  onTeamSelect,
  onAddToTeam,
  onRemoveFromTeam,
  onRoleChange,
}) => {
  return (
    <tr>
      <td className="px-6 py-4 whitespace-nowrap border-b border-gray-200 shadow-md">
        {user.email}
      </td>
      <td className="px-6 py-4 whitespace-nowrap border-b border-gray-200 shadow-md">
        {/* Inline team select (skipping separate TeamSelect file) */}
        <select onChange={(e) => onTeamSelect(user.id, e.target.value)}>
          <option value="">Select team...</option>
          {teams.map((team) => (
            <option key={team.id} value={team.id}>
              {team.name}
            </option>
          ))}
        </select>
        <button
          className="ml-20 bg-black hover:bg-green-700 text-white font-bold py-1 px-2 rounded"
          onClick={() => onAddToTeam(user.id)}
        >
          Add to Team
        </button>
      </td>
      <td className="px-6 py-4 whitespace-nowrap border-b border-gray-200 shadow-md">
        {user.teams && user.teams.length > 0 ? (
          <ul className="list-disc list-inside space-y-2">
            {user.teams.map((team) => (
              <li
                key={team.id}
                className="flex items-center justify-between border-b border-gray-200"
              >
                {team.name}
                <button
                  onClick={() => onRemoveFromTeam(user.id, team.id)}
                  className="ml-4 bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-2 rounded border-b border-gray-200"
                >
                  Remove
                </button>
              </li>
            ))}
          </ul>
        ) : (
          <p>No teams assigned</p>
        )}
      </td>
      <td className="border-b border-gray-200 shadow-md">
        <UserRoleSelect
          currentRole={user.role}
          onRoleChange={(newRole) => onRoleChange(user.id, newRole)}
        />
      </td>
    </tr>
  );
};

export default UserRow;

// ====== FILE: src\app\components\Admin\UserTable.tsx ======

"use client";
import React from "react";
import UserRow, { User, Team } from "./UserRow";

interface UserTableProps {
  users: User[];
  teams: Team[];
  onTeamSelect: (userId: number, teamId: string) => void;
  onAddToTeam: (userId: number) => void;
  onRemoveFromTeam: (userId: number, teamId: string) => void;
  onRoleChange: (userId: number, newRole: string) => void;
}

const UserTable: React.FC<UserTableProps> = ({
  users,
  teams,
  onTeamSelect,
  onAddToTeam,
  onRemoveFromTeam,
  onRoleChange,
}) => (
  <table className="min-w-full table-auto">
    <thead className="bg-black">
      <tr>
        <th className="px-6 py-3 text-left text-lg font-medium text-white uppercase tracking-wider">
          User
        </th>
        <th className="px-6 py-3 text-left text-lg font-medium text-white uppercase tracking-wider">
          Teams
        </th>
        <th className="px-6 py-3 text-left text-lg font-medium text-white uppercase tracking-wider">
          Assigned
        </th>
        <th className="px-6 py-3 text-left text-lg font-medium text-white uppercase tracking-wider">
          Role
        </th>
      </tr>
    </thead>
    <tbody>
      {users.map((user) => (
        <UserRow
          key={user.id}
          user={user}
          teams={teams}
          onTeamSelect={onTeamSelect}
          onAddToTeam={onAddToTeam}
          onRemoveFromTeam={onRemoveFromTeam}
          onRoleChange={onRoleChange}
        />
      ))}
    </tbody>
  </table>
);

export default UserTable;

// ====== FILE: src\app\components\ui\background-beams.tsx ======

"use client";
import React from "react";
import { motion } from "framer-motion";
import { cn } from "../../lib/utils";

export const BackgroundBeams = React.memo(
  ({ className }: { className?: string }) => {
    const paths = [
      "M-380 -189C-380 -189 -312 216 152 343C616 470 684 875 684 875",
      "M-373 -197C-373 -197 -305 208 159 335C623 462 691 867 691 867",
      "M-366 -205C-366 -205 -298 200 166 327C630 454 698 859 698 859",
      "M-359 -213C-359 -213 -291 192 173 319C637 446 705 851 705 851",
      "M-352 -221C-352 -221 -284 184 180 311C644 438 712 843 712 843",
      "M-345 -229C-345 -229 -277 176 187 303C651 430 719 835 719 835",
      "M-338 -237C-338 -237 -270 168 194 295C658 422 726 827 726 827",
      "M-331 -245C-331 -245 -263 160 201 287C665 414 733 819 733 819",
      "M-324 -253C-324 -253 -256 152 208 279C672 406 740 811 740 811",
      "M-317 -261C-317 -261 -249 144 215 271C679 398 747 803 747 803",
      "M-310 -269C-310 -269 -242 136 222 263C686 390 754 795 754 795",
      "M-303 -277C-303 -277 -235 128 229 255C693 382 761 787 761 787",
      "M-296 -285C-296 -285 -228 120 236 247C700 374 768 779 768 779",
      "M-289 -293C-289 -293 -221 112 243 239C707 366 775 771 775 771",
      "M-282 -301C-282 -301 -214 104 250 231C714 358 782 763 782 763",
      "M-275 -309C-275 -309 -207 96 257 223C721 350 789 755 789 755",
      "M-268 -317C-268 -317 -200 88 264 215C728 342 796 747 796 747",
      "M-261 -325C-261 -325 -193 80 271 207C735 334 803 739 803 739",
      "M-254 -333C-254 -333 -186 72 278 199C742 326 810 731 810 731",
      "M-247 -341C-247 -341 -179 64 285 191C749 318 817 723 817 723",
      "M-240 -349C-240 -349 -172 56 292 183C756 310 824 715 824 715",
      "M-233 -357C-233 -357 -165 48 299 175C763 302 831 707 831 707",
      "M-226 -365C-226 -365 -158 40 306 167C770 294 838 699 838 699",
      "M-219 -373C-219 -373 -151 32 313 159C777 286 845 691 845 691",
      "M-212 -381C-212 -381 -144 24 320 151C784 278 852 683 852 683",
      "M-205 -389C-205 -389 -137 16 327 143C791 270 859 675 859 675",
      "M-198 -397C-198 -397 -130 8 334 135C798 262 866 667 866 667",
      "M-191 -405C-191 -405 -123 0 341 127C805 254 873 659 873 659",
      "M-184 -413C-184 -413 -116 -8 348 119C812 246 880 651 880 651",
      "M-177 -421C-177 -421 -109 -16 355 111C819 238 887 643 887 643",
      "M-170 -429C-170 -429 -102 -24 362 103C826 230 894 635 894 635",
      "M-163 -437C-163 -437 -95 -32 369 95C833 222 901 627 901 627",
      "M-156 -445C-156 -445 -88 -40 376 87C840 214 908 619 908 619",
      "M-149 -453C-149 -453 -81 -48 383 79C847 206 915 611 915 611",
      "M-142 -461C-142 -461 -74 -56 390 71C854 198 922 603 922 603",
      "M-135 -469C-135 -469 -67 -64 397 63C861 190 929 595 929 595",
      "M-128 -477C-128 -477 -60 -72 404 55C868 182 936 587 936 587",
      "M-121 -485C-121 -485 -53 -80 411 47C875 174 943 579 943 579",
      "M-114 -493C-114 -493 -46 -88 418 39C882 166 950 571 950 571",
      "M-107 -501C-107 -501 -39 -96 425 31C889 158 957 563 957 563",
      "M-100 -509C-100 -509 -32 -104 432 23C896 150 964 555 964 555",
      "M-93 -517C-93 -517 -25 -112 439 15C903 142 971 547 971 547",
      "M-86 -525C-86 -525 -18 -120 446 7C910 134 978 539 978 539",
      "M-79 -533C-79 -533 -11 -128 453 -1C917 126 985 531 985 531",
      "M-72 -541C-72 -541 -4 -136 460 -9C924 118 992 523 992 523",
      "M-65 -549C-65 -549 3 -144 467 -17C931 110 999 515 999 515",
      "M-58 -557C-58 -557 10 -152 474 -25C938 102 1006 507 1006 507",
      "M-51 -565C-51 -565 17 -160 481 -33C945 94 1013 499 1013 499",
      "M-44 -573C-44 -573 24 -168 488 -41C952 86 1020 491 1020 491",
      "M-37 -581C-37 -581 31 -176 495 -49C959 78 1027 483 1027 483",
    ];
    return (
      <div
        className={cn(
          "absolute  h-full w-full inset-0  [mask-size:40px] [mask-repeat:no-repeat] flex items-center justify-center bg-slate-100",
          className
        )}
      >
        <svg
          className=" z-0 h-full w-full pointer-events-none absolute "
          width="100%"
          height="100%"
          viewBox="0 0 696 316"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M-380 -189C-380 -189 -312 216 152 343C616 470 684 875 684 875M-373 -197C-373 -197 -305 208 159 335C623 462 691 867 691 867M-366 -205C-366 -205 -298 200 166 327C630 454 698 859 698 859M-359 -213C-359 -213 -291 192 173 319C637 446 705 851 705 851M-352 -221C-352 -221 -284 184 180 311C644 438 712 843 712 843M-345 -229C-345 -229 -277 176 187 303C651 430 719 835 719 835M-338 -237C-338 -237 -270 168 194 295C658 422 726 827 726 827M-331 -245C-331 -245 -263 160 201 287C665 414 733 819 733 819M-324 -253C-324 -253 -256 152 208 279C672 406 740 811 740 811M-317 -261C-317 -261 -249 144 215 271C679 398 747 803 747 803M-310 -269C-310 -269 -242 136 222 263C686 390 754 795 754 795M-303 -277C-303 -277 -235 128 229 255C693 382 761 787 761 787M-296 -285C-296 -285 -228 120 236 247C700 374 768 779 768 779M-289 -293C-289 -293 -221 112 243 239C707 366 775 771 775 771M-282 -301C-282 -301 -214 104 250 231C714 358 782 763 782 763M-275 -309C-275 -309 -207 96 257 223C721 350 789 755 789 755M-268 -317C-268 -317 -200 88 264 215C728 342 796 747 796 747M-261 -325C-261 -325 -193 80 271 207C735 334 803 739 803 739M-254 -333C-254 -333 -186 72 278 199C742 326 810 731 810 731M-247 -341C-247 -341 -179 64 285 191C749 318 817 723 817 723M-240 -349C-240 -349 -172 56 292 183C756 310 824 715 824 715M-233 -357C-233 -357 -165 48 299 175C763 302 831 707 831 707M-226 -365C-226 -365 -158 40 306 167C770 294 838 699 838 699M-219 -373C-219 -373 -151 32 313 159C777 286 845 691 845 691M-212 -381C-212 -381 -144 24 320 151C784 278 852 683 852 683M-205 -389C-205 -389 -137 16 327 143C791 270 859 675 859 675M-198 -397C-198 -397 -130 8 334 135C798 262 866 667 866 667M-191 -405C-191 -405 -123 0 341 127C805 254 873 659 873 659M-184 -413C-184 -413 -116 -8 348 119C812 246 880 651 880 651M-177 -421C-177 -421 -109 -16 355 111C819 238 887 643 887 643M-170 -429C-170 -429 -102 -24 362 103C826 230 894 635 894 635M-163 -437C-163 -437 -95 -32 369 95C833 222 901 627 901 627M-156 -445C-156 -445 -88 -40 376 87C840 214 908 619 908 619M-149 -453C-149 -453 -81 -48 383 79C847 206 915 611 915 611M-142 -461C-142 -461 -74 -56 390 71C854 198 922 603 922 603M-135 -469C-135 -469 -67 -64 397 63C861 190 929 595 929 595M-128 -477C-128 -477 -60 -72 404 55C868 182 936 587 936 587M-121 -485C-121 -485 -53 -80 411 47C875 174 943 579 943 579M-114 -493C-114 -493 -46 -88 418 39C882 166 950 571 950 571M-107 -501C-107 -501 -39 -96 425 31C889 158 957 563 957 563M-100 -509C-100 -509 -32 -104 432 23C896 150 964 555 964 555M-93 -517C-93 -517 -25 -112 439 15C903 142 971 547 971 547M-86 -525C-86 -525 -18 -120 446 7C910 134 978 539 978 539M-79 -533C-79 -533 -11 -128 453 -1C917 126 985 531 985 531M-72 -541C-72 -541 -4 -136 460 -9C924 118 992 523 992 523M-65 -549C-65 -549 3 -144 467 -17C931 110 999 515 999 515M-58 -557C-58 -557 10 -152 474 -25C938 102 1006 507 1006 507M-51 -565C-51 -565 17 -160 481 -33C945 94 1013 499 1013 499M-44 -573C-44 -573 24 -168 488 -41C952 86 1020 491 1020 491M-37 -581C-37 -581 31 -176 495 -49C959 78 1027 483 1027 483M-30 -589C-30 -589 38 -184 502 -57C966 70 1034 475 1034 475M-23 -597C-23 -597 45 -192 509 -65C973 62 1041 467 1041 467M-16 -605C-16 -605 52 -200 516 -73C980 54 1048 459 1048 459M-9 -613C-9 -613 59 -208 523 -81C987 46 1055 451 1055 451M-2 -621C-2 -621 66 -216 530 -89C994 38 1062 443 1062 443M5 -629C5 -629 73 -224 537 -97C1001 30 1069 435 1069 435M12 -637C12 -637 80 -232 544 -105C1008 22 1076 427 1076 427M19 -645C19 -645 87 -240 551 -113C1015 14 1083 419 1083 419"
            stroke="url(#paint0_radial_242_278)"
            strokeOpacity="0.05"
            strokeWidth="0.5"
          ></path>

          {paths.map((path, index) => (
            <motion.path
              key={index}
              d={path}
              stroke={`url(#linearGradient-${index})`}
              strokeOpacity="0.6"
              strokeWidth="1"
            ></motion.path>
          ))}
          <defs>
            {paths.map((path, index) => (
              <motion.linearGradient
                id={`linearGradient-${index}`}
                x1="100%"
                x2="100%"
                y1="100%"
                y2="100%"
                key={`gradient-${index}`}
                animate={{
                  x1: ["0%", "100%"],
                  x2: ["0%", "95%"],
                  y1: ["0%", "100%"],
                  // y2: ["0%", `${93 + Math.random() * 8}%`],
                  y2: [
                    "0%",
                    `${Math.max(1, Math.min(100, 93 + Math.random() * 8))}%`,
                  ],
                }}
                transition={{
                  duration: Math.random() * 10 + 10,
                  ease: "easeInOut",
                  repeat: Infinity,
                  delay: Math.random() * 10,
                }}
              >
                <stop stopColor="#18CCFC" stopOpacity="0"></stop>
                <stop stopColor="#18CCFC"></stop>
                <stop offset="32.5%" stopColor="#6344F5"></stop>
                <stop offset="100%" stopColor="#AE48FF" stopOpacity="0"></stop>
              </motion.linearGradient>
            ))}

            <radialGradient
              id="paint0_radial_242_278"
              cx="0"
              cy="0"
              r="1"
              gradientUnits="userSpaceOnUse"
              gradientTransform="translate(352 34) rotate(90) scale(555 1560.62)"
            >
              <stop offset="0.0666667" stopColor="var(--neutral-300)"></stop>
              <stop offset="0.243243" stopColor="var(--neutral-300)"></stop>
              <stop offset="0.43594" stopColor="white" stopOpacity="0"></stop>
            </radialGradient>
          </defs>
        </svg>
      </div>
    );
  }
);
BackgroundBeams.displayName = "BackgroundBeams";

// ====== FILE: src\app\components\ui\button.tsx ======

"use client";

import * as React from "react";
import { Slot } from "@radix-ui/react-slot";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

const buttonVariants = cva(
  "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline:
          "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
);

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean;
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button";
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    );
  }
);
Button.displayName = "Button";

export { Button, buttonVariants };
